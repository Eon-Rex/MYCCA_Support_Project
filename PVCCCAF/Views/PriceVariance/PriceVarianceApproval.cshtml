
@model PVCCCAF.Models.PVFormViewModel
@using PVCCCAF.Models;
@{
    ViewBag.Title = "Price Variance Approval";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    bool isapprove = false;
    bool isreject = false;
    bool removebutton = false;
    bool isdatecheck = false;
    string headerstatus = Model.PVHeader.HeaderStatus.ToString();
    string Accountselection = Model.PVHeader.ACCOUNTSELECTIONID.ToString();
    bool ispostprice = Model.PVHeader.ISPOSTPRICE;
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet" type="text/css">
<style type="text/css">
    .first_right_side input {
        width: 110% !important;
    }

    .first_left_side {
        margin-top: 13px;
    }

    .first_right_side {
        margin-top: 13px;
    }

    .table.dataTable.no-footer {
        border-bottom: 1px solid #e51635;
        min-height: 0px;
        overflow-y: scroll;
    }

    .table.pvcAccountSelection tr th {
        text-align: left;
    }

    .table.tblpvcCustDetails tr th {
        text-align: left;
    }

    .table.pvcItemSelection tr th {
        text-align: left;
    }

    .table.tblpvcitemDetails tr th {
        text-align: left;
    }


    .table.pvcAccountSelection tr td {
        text-align: left;
    }

    .table.tblpvcCustDetails tr td {
        text-align: left;
    }

    .table.pvcItemSelection tr td {
        text-align: left;
    }

    .table.tblpvcitemDetails tr td {
        text-align: left;
    }

    .table.order_table tr td:last-child {
        text-align: left;
    }

    .chosen-container-multi .chosen-choices {
        position: relative;
        overflow-y: auto;
        margin: 0;
        padding: 0 5px;
        width: 100%;
        height: 60px;
        border: 1px solid #aaa;
        background-color: #fff;
        background-image: -webkit-gradient(linear, left top, left bottom, color-stop(1%, #eee), color-stop(15%, #fff));
        background-image: linear-gradient(#eee 1%, #fff 15%);
        cursor: text
    }

    .right-delete button {
        background: #fff;
        color: #e51635;
        display: inline-block;
        padding: 3px 19px 3px 13px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        -webkit-transition: all 0.4s ease-in-out 0s;
        -moz-transition: all 0.4s ease-in-out 0s;
        -o-transition: all 0.4s ease-in-out 0s;
        outline: none;
        margin-top: 3px;
        font-size: 13px;
        border: 1px solid transparent;
    }

    .btnSave_Add {
        color: #000 !important;
        background: #fff;
        min-width: 100px;
        min-width: 73px;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
        height: 26px;
    }

    .btnSave_Remove {
        color: #000 !important;
        background: #fff;
        /* color: #000; */
        min-width: 97px;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
    }

    table.table.order_table.order_table-right2 tr th:nth-child(8) {
        text-align: left;
    }

    .upload-image {
        width: 28px;
        margin-left: 7px;
        margin-top: 3px
    }

    .wrapperbox {
        background: #fff;
        float: left;
        width: 100%;
        position: relative;
    }

    .for_PVCNumSeq {
        font-size: 15px;
        color: #e51635;
        font-family: 'Montserrat', sans-serif;
        float: right;
        margin-right: 10px;
    }

    .btnSave_pvc {
        background: #e51635;
        color: #fff;
        margin-right: 20px;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        float: right;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
    }

    .btnlineStatusApp {
        background: #30a339;
        color: #fff;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 11px;
    }

    .btnlineStatusAppGray {
        background: #ceced5;
        color: #fff;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 11px;
    }


    .btnlineStatusRej {
        background: #e51635;
        color: #fff;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 11px;
    }

    .btnlineStatusRejGray {
        background: #ceced5;
        color: #fff;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 11px;
    }

    .for_AmountSign {
        color: #e51635;
        font-family: 'Montserrat', sans-serif;
    }

    .view-catalog-PVC {
        float: left;
        margin-top: 8px;
        margin-left: 8px;
    }

    /*.table.order_table tr td:last-child {
            text-align: left !important;
        }
    */
    .for_PVCNumSeq {
        font-size: 15px;
        color: #e51635;
        font-family: 'Montserrat', sans-serif;
    }



    .btnSave_RequestChange {
        background: #e51635;
        color: #fff;
        margin-top: 20px;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        /*float: right;*/
        float: left;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
    }

    .dataTables_wrapper .dataTables_paginate {
        float: right;
        text-align: right;
        padding-top: 0.25em;
        font-size: 13px;
    }

    .dataTables_wrapper .dataTables_info {
        clear: both;
        float: left;
        padding-top: 0.755em;
        font-size: 13px;
    }

    .dataTables_wrapper .dataTables_length {
        float: left;
        font-size: 25px;
    }

    .Selection-Account {
        background: rgba(0,0,0,0.9);
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 9;
        display: none;
    }

    .Selection-AccountPopup {
        background: #f9f9f9;
        width: 1000px;
        height: 600px;
        text-align: center;
        border-radius: 10px;
        display: block;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 5000;
    }

    .Selection-GroupPopup {
        background: #f9f9f9;
        width: 650px;
        height: 300px;
        text-align: center;
        border-radius: 10px;
        display: block;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 5000;
    }

    .btn-btnPopup {
        background: #e51635;
        color: #fff;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
    }

    .closepopup {
        float: right;
        width: 22px;
        cursor: pointer;
    }

    .btnSave_selection {
        background: #e51635;
        color: #fff;
        margin-right: 20px;
        padding: 3px 16px 3px 16px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.4s ease-in-out 0s;
        font-size: 13px;
    }
</style>


<input type="hidden" id="hdnNewGroup" value="1">

@if (!Model.PVHeader.ISEDITAFTERAXSYNC)
{
    <!-----Account Selection-->
    <div class="Selection-Account" id="SelectionAccountPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeSelectionAccount()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                @*<div class="row">
                    <button class="btn-btnPopup" style="margin-left: 20px; margin-bottom: 10px;" id="btnApplicants" type="button" accesskey="A" onclick="OpenApplicantsPopup()">Applicants</button>

                </div>*@

                <div class="row">

                    @if (Model.PVHeader.HeaderStatus == 1 || Model.PVHeader.HeaderStatus == 6)
                    {
                        <div style="margin-left: 20px;">
                                @Html.DropDownList("PopUpAccountSelection", Enumerable.Empty<SelectListItem>(), new
                           {
                               @id = "drpAccountSelectionPopup",
                               @class = "searchable",
                               style = "width:150px"

                           })
                           
                        </div>
                    }

                    <button class="btn-btnPopup" style="margin-left: 20px;" id="btnAccountAdd" type="button" accesskey="A" onclick="AddSelectionAccount()">+ Add</button>

                    <button class="btn-btnPopup" type="button" style="margin-left: 20px;" id="btnAccountRemove" accesskey="A" onclick="RemoveSelectionAccount()">- Remove</button>

                    <button class="btn-btnPopup" style="margin-left: 20px" id="btnApplicants" type="button" accesskey="A" onclick="OpenApplicantsPopup()">Applicants</button>
                    @if (!ispostprice && Model.PVHeader.HeaderStatus == 6)
                    {
                        <button class="btn-btnPopup" type="button" style="margin-left: 20px;" id="btnRenameGroup" accesskey="A" onclick="RenameSelectionAccount()">Rename</button>
                    }
                    <span id="ErrorMsg" style="color: red ;padding: 5px 22px 0px"></span>
                </div>
            </div>


            <table id="pvcAccountSelection" style="width: 50%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table pvcAccountSelection">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkAccountSelection"></th>
                        <th>Account Selection</th>
                        <th>Account Name</th>
                    </tr>
                    @*@if (Model.PVHeader.HeaderStatus == 1 || Model.PVHeader.HeaderStatus == 6)
                    {
                        <tr>
                            <td>
                            </td>
                            <td>
                                @Html.DropDownList("PopUpAccountSelection", Enumerable.Empty<SelectListItem>(), new
                                      {
                                          @id = "drpAccountSelectionPopup",
                                          @class = "searchable",
                                          style = "width:150px"

                                      })
                            </td>

                            <td></td>
                        </tr>
                    }*@
                </thead>
                <tbody>
                </tbody>
                <tfoot>

                </tfoot>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="CustDetailsPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeApplicantsPopup()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                <div class="row">
                    @if (!ispostprice)
                    {
                        <div  style="width: 195px">                            
                                @Html.DropDownList("PopUpcustSelection", Enumerable.Empty<SelectListItem>(), new
                       {
                           @id = "drpCustSelectionPopup",
                           @class = "searchable",
                           style = "width:150px"
                       })   
                        </div>

                        <button class="btn-btnPopup" style="display:none; margin-left: 20px;" id="btnCustomerAccountAdd" type="button" accesskey="A" onclick="AddCustomerAccount()">+ Add</button>

                        <button class="btn-btnPopup" type="button" style="display: none; margin-left: 20px;" id="btnCustomerAccountRemove" accesskey="A" onclick="RemoveCustomerAccount()">- Remove</button>
                    }
                    <span id="ErrorCustMsg" style="color: red ;padding: 5px 22px 0px"></span>
                </div>
            </div>

            <table id="tblpvcCustDetails" style="width: 70%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table tblpvcCustDetails">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkCustAccountSelection"></th>
                        <th>Customer Account</th>
                        <th>Customer Name</th>
                    </tr>

                    @*<tr>
                        <td>
                        </td>
                        <td>
                            @Html.DropDownList("PopUpcustSelection", Enumerable.Empty<SelectListItem>(), new
                       {
                           @id = "drpCustSelectionPopup",
                           @class = "searchable",
                           style = "width:150px"

                       })
                        </td>

                      
                    </tr>*@

                </thead>
                <tbody>
                </tbody>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="RenameGroupPopup">
        <div class="Selection-GroupPopup">
            <span id="ErrorRenameGrpMsg" style="color: red ;padding: 5px 22px 0px"></span>
            <input type="hidden" id="hdnAccSelectionid" />
            <input type="hidden" id="hdnAccSelectionNameid" />
            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeNewGroupPopup()" title="Close">

            <table class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th>Rename New Group</th>
                    </tr>
                </thead>

            </table>


            <div class="row">
                <div class="col-lg-3 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                    <div class="first_left_side mobileview-col-xs-6">
                        <p>Account Selection</p>
                        <p>Account Name</p>

                    </div>
                </div>

                <div class="col-lg-6 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    <div class="first_left_side for-float-right">
                        <input type="text" id="txtAccountSelection" style="font-size: 12px;" />
                        <input type="text" id="txtAccountName" style="font-size: 12px;" />
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-top:10px;float:right;">
                <button class="btn-btnPopup" type="button" style="width:80px" onclick="UpdateRenameGroup()" id="btnUpdateGroupAdd">Update</button>
            </div>

        </div>
    </div>
    <!-----End-->
    <!-----Item Selection-->
    <div class="Selection-Account" id="SelectionItemPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeSelectionItem()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                <div class="row">
                    <button class="btn-btnPopup" style="margin-left: 20px; margin-bottom: 10px;" id="btnitemApplicants" type="button" accesskey="A" onclick="OpenItemsDetailsPopup()">Items</button>
                    
                    @if (!ispostprice && Model.PVHeader.HeaderStatus == 6)
                    {
                        <button class="btn-btnPopup" type="button" style="margin-left: 20px; margin-bottom: 10px;" id="btnRenameItemGroup" accesskey="A" onclick="RenameitemAccount()">Rename</button>
                    }
                    <span id="ErrorItemMsg" style="color: red ;padding: 5px 22px 0px"></span>

                </div>

                @*<div class="row">*@
                    @*@if (Model.PVHeader.HeaderStatus==1)
                        {

                        <button class="btn-btnPopup" type="button" style="margin-left: 20px;" id="btnitemRemove" accesskey="A" onclick="RemoveItemAccount()">- Remove</button>
                        }*@
                    @*@if (!ispostprice && Model.PVHeader.HeaderStatus == 6)
                    {
                        <button class="btn-btnPopup" type="button" style="margin-left: 20px;" id="btnRenameItemGroup" accesskey="A" onclick="RenameitemAccount()">Rename</button>
                    }
                    <span id="ErrorItemMsg" style="color: red ;padding: 5px 22px 0px"></span>*@
                @*</div>*@
            </div>


            <table id="pvcItemSelection" style="width:70%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table pvcItemSelection">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkitemSelection"></th>
                        <th>Item Selection</th>
                        <th>
                            Item Name
                            @if (Model.PVHeader.HeaderStatus == 1)
                            {
                                <i id="btnitemRemove" style="float: right; margin-top: 9px; cursor: pointer;" class="fa-solid fa-trash-can fa-lg" onclick="RemoveItemAccount()"></i>
                            }
                        </th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>

                </tfoot>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="itemDetailsPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeItemsDetailsPopup()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                <div class="row">
                    @if (!ispostprice)

                    {
                        <div style="padding-left: 24px">
                            @Html.DropDownList("PopUpitemdetails", Enumerable.Empty<SelectListItem>(), new
                       {
                           @id = "drpitemdetailsPopup",
                           @class = "searchable",
                           style = "width:250px;"

                       })
                        </div>
                        <button class="btn-btnPopup" style="display:none; margin-left: 20px;" id="btnitemDetailsAdd" type="button" accesskey="A" onclick="AdditemGroupDetails()">+ Add</button>

                        <button class="btn-btnPopup" type="button" style="display: none; margin-left: 20px;" id="btnitemDetailsRemove" accesskey="A" onclick="RemoveitemGroupDetails()">- Remove</button>

                        @*<button class="btn-btnPopup" style="margin-left: 165px;" id="btnitemDetailsAdd" type="button" accesskey="A" onclick="AdditemGroupDetails()">+ Add</button>

                        <button class="btn-btnPopup" type="button" style="margin-left: 20px;" id="btnitemDetailsRemove" accesskey="A" onclick="RemoveitemGroupDetails()">- Remove</button>*@
                    }
                    <span id="ErroritemDetailsMsg" style="color: red ;padding: 5px 22px 0px"></span>
                </div>
            </div>

            <table id="tblpvcitemDetails" style="width: 60%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table tblpvcitemDetails">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="itemdetailschkbox()" id="chkitemdetailsSelection"></th>
                        <th>Item Number</th>
                        <th>Product Name</th>
                    </tr>
                    @*<tr>
                        <td>
                        </td>
                        <td>
                            @Html.DropDownList("PopUpitemdetails", Enumerable.Empty<SelectListItem>(), new
                                  {
                                      @id = "drpitemdetailsPopup",
                                      @class = "searchable",
                                      style = "width:250px"

                                  })
                        </td>

                        <td></td>
                    </tr>*@
                </thead>
                <tbody>
                </tbody>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="RenameItemGroupPopup">
        <div class="Selection-GroupPopup">
            <span id="ErrorRenameItemGrpMsg" style="color: red ;padding: 5px 22px 0px"></span>
            <input type="hidden" id="hdnItemid" />
            <input type="hidden" id="hdnItemNameid" />
            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeItemGroupPopup()" title="Close">

            <table class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th>Rename Item Group</th>
                    </tr>
                </thead>

            </table>


            <div class="row">
                <div class="col-lg-3 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                    <div class="first_left_side mobileview-col-xs-6">
                        <p>Item Selection</p>
                        <p>Item Name</p>

                    </div>
                </div>

                <div class="col-lg-6 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    <div class="first_left_side for-float-right">
                        <input type="text" id="txtItemSelection" style="font-size: 12px;" />
                        <input type="text" id="txtItemName" style="font-size: 12px;" />
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-top:10px;float:right;">
                <button class="btn-btnPopup" type="button" style="width:80px" onclick="UpdateItemRenameGroup()" id="btnUpdateItemGroupAdd">Update</button>
            </div>

        </div>
    </div>
    <!-----end-->

    //
    if (Model.PVHeader.HeaderStatus == 1)
    {



        <div class="loader_overlay">
            <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
        </div>

        <div class="wrapperbox">
            <div class="top-title">
                <h2>Price Approval Form</h2>


                <div style="margin-bottom:29px">
                    @if (Model.PVHeader.PVCNO == "")
                    {
                        <button class="btnSave_pvc" type="submit" onclick="SavePVCData()" id="btnsavePVC">Save</button>
                    }
                    else
                    { <button class="btnSave_pvc" type="submit" onclick="UpdatePVCDataApproval()" id="btnUpdatePVC">Update</button>}
                    <span id="Pvnumber" class="for_PVCNumSeq">@ViewBag.PVCNUMSEQ</span><span class="for_PVCNumSeq"> PV No :-</span>

                </div>


            </div>

            <div class="for-top-border">
                <div class="container" style="width:1315px">
                    <div class="row">
                        <div style="width: 38%;">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                <div class="first_left_side mobileview-col-xs-6">
                                    <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_left_side for-float-right">
                                    @Html.DropDownListFor(m => m.PVHeader.ENTITYID, ViewBag.EntityDropdown as SelectList, new
                                    {
                                        @id = "PVHeader_Entity",
                                   @class = "searchable",
                                        style = "width:250px",
                                   @onchange = "OnEnityChange();"
                               })
                                    @Html.DropDownListFor(m => m.PVHeader.CUSTAPPLICABLETYPEID, ViewBag.CustomerApplicableDropdown as SelectList, new
                               {
                                   @id = "PVHeader_CustomerApplicable",
                                   @value = Model.PVHeader.CustomerApplicable,
                                   @class = "searchable",
                                   style = "width:250px",
                                   @onchange = "CustomerApplicablechange();"
                               })
                                    @if (ViewBag.AccountSelection as SelectList == null)
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.AccountSelection, Enumerable.Empty<SelectListItem>(),
    new { @id = "PVHeader_AccountSelection", @value = Model.PVHeader.AccountSelection, @class = "searchable", style = "width:250px", multiple = "multiple" })
                                    }
                                    else
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                   {
                                       @id = "PVHeader_AccountSelection",
                                       @value = Model.PVHeader.AccountSelection,
                                       @class = "searchable",
                                       style = "width:250px",
                                       multiple = "multiple"
                                   })
                                    }

                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">

                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                    <p>@Html.Label("Start Date")</p>
                                    <p>@Html.Label("End Date")</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.BranchWithVat, ViewBag.BranchDropdown as SelectList,
                                    new { @id = "PVHeader_Branch", @class = "searchable", style = "width:195px", @onchange = "BranchChange();" })

                                    @if (Model.PVLine.Count > 0)
                                    {
                                        isdatecheck = true;
                                        <div style="padding-top: 8px;">
                                            @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @id = "StartDate", style = "width:170px" })
                                        </div>
                                        @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:170px" })

                                    }
                                    else
                                    {
                                        <div style="padding-top: 8px;">
                                            @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @id = "StartDate", style = "width:200px;padding-left: 9px;" })
                                        </div>
                                        @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:200px" })
                                    }
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.TIERID, ViewBag.PriceTierDropdown as SelectList,
    new { @id = "PVHeader_PriceTier", @class = "searchable", style = "width:260px" })
                                    @Html.TextAreaFor(m => m.PVHeader.Description, new
                               {
                                   @placeholder = "Free Text (Max 30 Characters)",
                                   @rows = "2",
                                   @cols = "25",
                                   @maxlength = "30",
                                   style = "width:260px;height: 55px;"
                               })
                                </div>
                            </div>

                        </div>




                    </div>
                    <div class="row col">
                        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                            <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(1)" id="btnSelectionAccount">Selection</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="left-side-bar for-order-margin">
            <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkBoxSelectAll"></th>
                        <th>No</th>
                        <th>Item Type</th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                        <th style="width: 85px;">Current Price (VEP)</th>
                        <th style="width: 85px;">New Price (VEP)</th>
                        <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                        <th style="width: 85px;">Discount</th>
                        <th style="width: 85px;">%Discount</th>
                        <th style="width: 92px;">Expected Volume (PC)</th>
                        <th style="text-align: center; cursor: pointer;width: 120px;"><i class="fa-solid fa-circle-check fa-2x" onclick="UpdateAllLineStatusApproval('2')"></i></th>
                        <th style="text-align: center; cursor: pointer;width: 75px;"><i class="fa-regular fa-circle-xmark fa-2x" onclick="UpdateAllLineStatusApproval('3')"></i></th>
                        @*<th style="width: 45px;"></th>
                        <th style="width: 40px;"></th>*@
                        @*<th><i style="cursor: pointer;" class="fa-solid fa-circle-plus fa-2x" onclick="AddPvcItemline(1);"></i></th>
                        <th><i style="cursor: pointer;" class="fa-solid fa-circle-minus fa-2x" onclick="RemovePVLine(1)"></i></th>*@



                    </tr>
                </thead>
                <tbody style="background-color: #dee0df;">
                    @if (Model != null)
                    {
                        PVFLine d = new PVFLine();
                        <tr>
                            <td><span class="mobile-before-label"></span></td>
                            <td><span class="mobile-before-label"></span></td>
                            <td><span class="mobile-before-label"></span>@Html.DropDownListFor(m => d.ItemType, ViewBag.ItemType as SelectList, new { @style = "width:145px", @class = "searchable", @onchange = "ItemTypeChange();" })</td>

                            <td><span class="mobile-before-label"></span>@Html.DropDownList("drpItemSelection", new SelectList(Enumerable.Empty<SelectListItem>()), new { @style = "width:160px", @class = "tabel_text_box searchable", @onchange = "ItemSelectionchnage();" })</td>
                            <td><span class="mobile-before-label"></span>@Html.TextBoxFor(m => d.ItemName, new { @class = "", @readonly = "true", @style = "width:200px; font-size: 12px;" })</td>
                            <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("CurrentPriceVEP", null, new { @id = "d_CurrentPriceVEP", @class = "allow_numeric", @onchange = "addZero();CalculateDiscount();", @style = "width:45px; font-size: 12px;" })</td>
                            <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("NewPriceVEP", null, new { @id = "d_NewPriceVEP", @class = "allow_numeric", @onchange = "addZero();CalculateDiscount();", @style = "width:45px; font-size: 12px;" })</td>
                            <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("NewPriceVIP", null, new { @id = "d_NewPriceVIP", @style = "width:45px; font-size: 12px;", @readonly = "true" })</td>
                            <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("Discount", null, new { @id = "d_Discount", @readonly = "true", @style = "width:40px; font-size: 12px;" })</td>
                            <td><span class="mobile-before-label"></span>@Html.TextBoxFor(m => d.DiscountPer, new { @readonly = "true", @style = "width:44px; font-size: 12px; margin-left: 5px;" })<span> % </span></td>
                            <td><span class="mobile-before-label"></span>@Html.TextBox("ExpectedVolumn", null, new { @id = "d_ExpectedVolumn", @class = "dontallow_decimal", @style = "width:70px; font-size: 12px;" })</td>
                            @*<td><span class="mobile-before-label"></span></td>
                            <td><span class="mobile-before-label"></span></td>*@
                            <td style="text-align:center"><i style="cursor: pointer;" class="fa-solid fa-circle-plus fa-2x" onclick="AddPvcItemline(1);"></i></td>
                            <td style="text-align:center"><i style="cursor: pointer;" class="fa-solid fa-circle-minus fa-2x" onclick="RemovePVLine(1)"></i></td>

                        </tr>





                    }

                </tbody>
                <tfoot>
                    @{
                        foreach (PVFLine line in Model.PVLine)
                        {
                            <tr>
                                <td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></td>
                                <td>@line.No</td>
                                <td>@line.ItemTypeDesc</td>
                                <td>@line.ItemSelection</td>
                                <td>@line.ItemName</td>
                                <td><span class="for_AmountSign">$ </span>@line.CurrentPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@line.NewPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@line.NewPriceVIP</td>
                                <td><span class="for_AmountSign">$ </span>@line.Discount</td>
                                <td>@line.DiscountPer<span> % </span></td>
                                <td>@line.ExpectedVolumn</td>
                                @if (@line.ISAPPROVE == 0)
                                {
                                    isapprove = true;
                                }
                                else if (@line.ISAPPROVE == 1)
                                {
                                    isreject = true;
                                }
                                else
                                {
                                    isapprove = false;
                                    isreject = false;
                                    removebutton = true;
                                }
                                <td style="text-align:center">
                                    @if (@line.ISAPPROVE == 0)
                                    {
                                        <button class="btnlineStatusApp" onclick="UpdateLineStatusApproval('2','@line.ItemSelection')" type="button" id="btnstatusline">APPROVE</button>

                                    }
                                    else
                                    {
                                        <button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval('2','@line.ItemSelection')" type="button" id="btnstatusline">APPROVE</button>
                                    }

                                </td>
                                <td style="text-align:center">
                                    @if (@line.ISAPPROVE == 1)
                                    {
                                        <button class="btnlineStatusRej" onclick="UpdateLineStatusApproval('3','@line.ItemSelection')" type="button" id="btnstatusline">REJECT</button>

                                    }
                                    else
                                    {

                                        <button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval('3','@line.ItemSelection')" type="button" id="btnstatusline">REJECT</button>

                                    }


                                </td>
					
                            </tr>

                        }
                    }

                </tfoot>
            </table>

        </div>

        <br>
        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
            <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(1)" id="btnSelectionItem">Selection</button>
        </div>
        <br>
        <br>
        <div class="for-top-border">
            <div class="row col">
                <div style="padding-left: 15px;">

                    <div class="first_left_sidecomment mobileview-col-xs-6">
                        <p style="font-weight: bold; font-size: 13px;">Comments</p>
                        <p>@Html.Label("1st Approver :")</p>
                        <p>@Html.Label("2nd Approver :")</p>
                        <p>@Html.Label("3rd Approver :")</p>
                    </div>
                </div>

                <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    <div class="first_left_sidecomment for-float-right">
                        <br>
                        @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @maxlength = "30" })
                        @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true", @maxlength = "30" })
                        @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true", @maxlength = "30" })
                    </div>
                </div>


                <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                </div>

                <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    @if (isreject)
                    {
                        <button class="btnSave_RequestChange" type="button" onclick="UpdateHeaderStatus('0','1','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                    }
                    else
                    {
                        <button class="btnSave_RequestChange" style="display: none;" type="button" onclick="UpdateHeaderStatus('0','1','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                    }
                </div>

            </div>
        </div>

        <div class="for-bg-color">
            <div class="row" style="padding: 8px;width:99%">
                <div class="col-lg-12 col-md-4 col-sm-4 col-xs-16">
                    <div class="middel-center">
                        <p>Upload Attachment :</p>
                    </div>
                    <div id="divImgUpload" class="right-delete">
                        @{
                            for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                            {
                                string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                if (ext.ToUpper() == ".PDF")
                                {
                                    <input type="checkbox" style="margin-left:5px" class="singlechkimage" id="@Model.PVHeader.PvImages[i].PVCIMAGENAME">

                                    <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                        <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                    </a>

                                }
                                else if (ext.ToUpper() == ".DOCX")
                                {
                                    <input type="checkbox" style="margin-left: 5px" class="singlechkimage" id="@Model.PVHeader.PvImages[i].PVCIMAGENAME">

                                    <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                        <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                    </a>

                                }
                                else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                {
                                    <input type="checkbox" style="margin-left: 5px" class="singlechkimage" id="@Model.PVHeader.PvImages[i].PVCIMAGENAME">

                                    <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                        <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                    </a>

                                }
                                else if (ext.ToUpper() == ".XLSX")
                                {
                                    <input type="checkbox" style="margin-left: 5px" class="singlechkimage" id="@Model.PVHeader.PvImages[i].PVCIMAGENAME">

                                    <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                        <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                    </a>

                                }
                                @*else if (ext.ToUpper() == ".TXT")
                                {
                                    <input type="checkbox" style="margin-left: 5px" class="singlechkimage" id="@Model.PVHeader.PvImages[i].PVCIMAGENAME">

                                    <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                        <img class="upload-image" src="~/AcxiomDesign/images/notepadimage.png" />
                                    </a>

                                }*@

                            }
                        }
                        <button class="btndeletecss" type="button" style="margin-left: 10px;float:right" onclick="Imagedelete('@Model.PVHeader.PVCNO')" id="btnDelete">Delete</button>


                    </div>


                </div>
            </div>
        </div>

        <br>

        <div class="for-bg-color">
            <div class="row" style="padding: 8px;width:99%">

                <div style="width: 36%; margin-left: 16px;">
                    <div class="middel-center">
                        <p>Attachment :</p>
                    </div>

                    <div class="right-middel">

                        <div class="view-catalog-PVC mobileviewcatelog">
                            <div class="browse_btn">
                                <input type="file" id="FileUpload" name="FileUpload" class="" />
                            </div>

                        </div>
                    </div>
                    <div class="right-middel">
                        <button style="margin-left: 20px; height: 33px;" type="button" accesskey="A" onclick="validatefile();">Upload Files</button>
                    </div>

                </div>

                <div style="width: 61%;">
                    <div class="right-middel">
                        @if (isreject && isapprove == false && removebutton == false)
                        {
                            <button style="margin-left: 20px; height: 33px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','3', '@Model.PVHeader.ENTITYID');">Reject</button>
                        }
                        else
                        {<button style="margin-left: 20px; height: 33px; display: none; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','3', '@Model.PVHeader.ENTITYID');">Reject</button>}
                    </div>
                    <div class="right-middel">
                        @if (isapprove && isreject == false && removebutton == false)
                        {
                            <button style="margin-left: 20px; height: 33px; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','2', '@Model.PVHeader.ENTITYID');">Approve</button>
                        }
                        else
                        {
                            <button style="margin-left: 20px; height: 33px; display: none; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','2', '@Model.PVHeader.ENTITYID');">Approve</button>
                        }
                    </div>

                </div>

            </div>
        </div>
    }
    else
    {


        if (Model.PVHeader.HeaderStatus == 2)// 2nd Approver screen
        {
            <input type="hidden" value="@Model.PVHeader.CUSTAPPLICABLETYPEID" id="PVHeader_CustomerApplicable">
            <div class="loader_overlay">
                <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
            </div>

            <div class="wrapperbox">
                <div class="top-title">
                    <h2>Price Approval Form </h2>

                    <div style="margin-bottom:29px">
                        <span id="Pvnumber" class="for_PVCNumSeq">@Model.PVHeader.PVCNO</span><span class="for_PVCNumSeq"> PV No :-</span>

                    </div>

                </div>
                <div class="for-top-border">
                    <div class="container" style="width:1315px">
                        <div class="row">
                            <div style="width: 38%;">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                    <div class="first_left_side mobileview-col-xs-6">
                                        <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_left_side for-float-right">
                                        @Html.TextBoxFor(m => m.PVHeader.Entity, new { style = "width:250px", @readonly = "true" })
                                        @Html.TextBoxFor(m => m.PVHeader.CustomerApplicable, new { style = "width:250px", @id = "customerapplicable", @readonly = "true" })
                                        @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                   {
                                       @id = "PVHeader_AccountSelection",
                                       @value = Model.PVHeader.AccountSelection,
                                       @class = "searchable",
                                       style = "width:250px",
                                       multiple = "multiple"

                                   })
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">
                                <div class="col-lg-3 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                        <p>@Html.Label("Start Date")</p>
                                        <p>@Html.Label("End Date")</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-9 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_right_side">
                                        @Html.TextBoxFor(m => m.PVHeader.Branch, new { style = "width:170px; padding-bottom: 8px;", @readonly = "true" })
                                        @if (Model.PVLine.Count > 0)
                                        {
                                            isdatecheck = true;
                                            @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                            @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                        }
                                        else
                                        {
                                            @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                            @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                        }
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="col-md-4 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                    </div>
                                </div>

                                <div class="col-md-8 col-md-8 col-sm-8col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        @Html.TextBoxFor(m => m.PVHeader.PriceTier, new { style = "width:250px; padding-bottom: 8px;", @readonly = "true" })
                                        @Html.TextAreaFor(m => m.PVHeader.Description, new
                                   {
                                       @readonly = "true",
                                       @placeholder = "Free Text (Max 30 Characters)",
                                       @rows = "2",
                                       @cols = "25",
                                       @maxlength = "30",
                                       style = "width:228px;height: 54px;"
                                   })
                                    </div>
                                </div>

                            </div>






                        </div>
                        <div class="row col">
                            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                                <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(2)" id="btnSelectionAccount">Selection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="left-side-bar for-order-margin">
                <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="chkBoxSelectAll"></th>
                            <th>No</th>
                            <th>Item Type</th>
                            <th>Item Selection</th>
                            <th>Item Name</th>
                            <th style="width: 85px;">Current Price (VEP)</th>
                            <th style="width: 85px;">New Price (VEP)</th>
                            <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                            <th style="width: 85px;">Discount</th>
                            <th style="width: 85px;">%Discount</th>
                            <th style="width: 92px;">Expected Volume (PC)</th>
                            
                            @*<th><img src="/AcxiomDesign/images/right_icon.png" onclick="UpdateAllLineStatus('4', '@Model.PVHeader.ENTITYID')"></th>
                                <th><img src="/AcxiomDesign/images/close_red.png" onclick="UpdateAllLineStatus('5', '@Model.PVHeader.ENTITYID')"></th>*@
                            <th style="text-align: left; padding-left: 25px; cursor: pointer;"><i class="fa-solid fa-circle-check fa-2x" onclick="UpdateAllLineStatus('4', '@Model.PVHeader.ENTITYID')"></i></th>
                            <th style="text-align: left; padding-left:21px;  cursor: pointer;"><i class="fa-regular fa-circle-xmark fa-2x" onclick="UpdateAllLineStatus('5', '@Model.PVHeader.ENTITYID')"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null)
                        {
                            foreach (PVFLine d in Model.PVLine)
                            {
                                <tr>
                                    <td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></td>
                                    <td>@d.No</td>
                                    <td>@d.ItemTypeDesc</td>
                                    <td>@d.ItemSelection</td>
                                    <td>@d.ItemName</td>
                                    <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                    <td>@d.DiscountPer <span> % </span></td>
                                    <td>@d.ExpectedVolumn</td>
                                    @if (@d.ISAPPROVE == 0)
                                    {
                                        isapprove = true;

                                    }
                                    else if (@d.ISAPPROVE == 1)
                                    {
                                        isreject = true;

                                    }
                                    else
                                    {
                                        isapprove = false;
                                        isreject = false;

                                    }

                                    <td>
                                        @if (@d.ISAPPROVE == 0)
                                        {
                                            <button class="btnlineStatusApp" onclick="UpdateLineStatus('4','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">APPROVE</button>

                                        }
                                        else
                                        {
                                            <button class="btnlineStatusAppGray" onclick="UpdateLineStatus('4','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">APPROVE</button>
                                        }

                                    </td>
                                    <td>
                                        @if (@d.ISAPPROVE == 1)
                                        {
                                            <button class="btnlineStatusRej" onclick="UpdateLineStatus('5','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">REJECT</button>

                                        }
                                        else
                                        {

                                            <button class="btnlineStatusRejGray" onclick="UpdateLineStatus('5','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">REJECT</button>

                                        }


                                    </td>
                                </tr>

                            }
                        }


                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>

            </div>

            <br>
            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(2)" id="btnSelectionItem">Selection</button>
            </div>
            <br>
            <br>
            <div class="for-top-border">

                <div class="row col">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true", @maxlength = "30" })
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">

                        @if (isreject)
                        {
                            <button class="btnSave_RequestChange" type="button" onclick="UpdateHeaderStatus('0','2','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                        }
                        else
                        {
                            <button class="btnSave_RequestChange" style="display: none;" type="button" onclick="UpdateHeaderStatus('0','2','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                        }
                    </div>
                </div>
            </div>

            <div class="for-bg-color">

                <div class="row col">

                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-16">
                        <div class="middel-center">
                            <p>Attachment :</p>
                        </div>
                        <div class="right-middel">
                            @{
                                for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                {
                                    string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                    if (ext.ToUpper() == ".PDF")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".DOCX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".XLSX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                        </a>

                                    }

                                }
                            }
                        </div>

                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-16">
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">
                        <div class="right-middel">
                            @if (isapprove && isreject == false)
                            {
                                <button style="margin-left: 20px;   margin-bottom: 5px;" type="button" id="btnEscalate" accesskey="A" onclick="UpdateHeaderStatus('3','0', '@Model.PVHeader.ENTITYID');">Escalate</button>
                            }
                            else
                            {
                                <button style="margin-left: 20px; margin-bottom: 5px; display: none;" type="button" id="btnEscalate" accesskey="A" onclick="UpdateHeaderStatus('3','0', '@Model.PVHeader.ENTITYID');">Escalate</button>
                            }


                        </div>
                        <div class="right-middel">
                            @if (isreject && isapprove == false)
                            {
                                <button style="margin-left: 20px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','5', '@Model.PVHeader.ENTITYID');">Reject</button>
                            }
                            else
                            {<button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','5', '@Model.PVHeader.ENTITYID');">Reject</button>}
                        </div>
                        <div class="right-middel">
                            @if (isapprove && isreject == false)
                            {
                                <button style="margin-left: 20px;  margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','4', '@Model.PVHeader.ENTITYID');">Approve</button>
                            }
                            else
                            {
                                <button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','4', '@Model.PVHeader.ENTITYID');">Approve</button>
                            }
                        </div>


                    </div>
                </div>

            </div>

        }

        else if (Model.PVHeader.HeaderStatus == 4)// 3rd Approver
        {
            <input type="hidden" value="@Model.PVHeader.CUSTAPPLICABLETYPEID" id="PVHeader_CustomerApplicable">
            <div class="loader_overlay">
                <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
            </div>

            <div class="wrapperbox">
                <div class="top-title">
                    <h2>Price Approval Form</h2>

                    <div style="margin-bottom:29px">
                        <span id="Pvnumber" class="for_PVCNumSeq">@Model.PVHeader.PVCNO</span><span class="for_PVCNumSeq"> PV No :-</span>

                    </div>

                </div>
                <div class="for-top-border">
                    <div class="container" style="width:1315px">
                        <div class="row">
                            <div style="width: 38%;">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                    <div class="first_left_side mobileview-col-xs-6">
                                        <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_left_side for-float-right">
                                        @Html.TextBoxFor(m => m.PVHeader.Entity, new { style = "width:250px", @readonly = "true" })
                                        @Html.TextBoxFor(m => m.PVHeader.CustomerApplicable, new { style = "width:250px", @id = "customerapplicable", @readonly = "true" })
                                        @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                   {
                                       @id = "PVHeader_AccountSelection",
                                       @value = Model.PVHeader.AccountSelection,
                                       @class = "searchable",
                                       style = "width:250px",
                                       multiple = "multiple"

                                   })
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">
                                <div class="col-lg-3 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                        <p>@Html.Label("Start Date")</p>
                                        <p>@Html.Label("End Date")</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-9 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_right_side">
                                        @Html.TextBoxFor(m => m.PVHeader.Branch, new { style = "width:170px; padding-bottom: 8px;", @readonly = "true" })
                                        @if (Model.PVLine.Count > 0)
                                        {
                                            isdatecheck = true;
                                            @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                            @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                        }
                                        else
                                        {
                                            @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                            @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                        }
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="col-md-4 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                    </div>
                                </div>

                                <div class="col-md-8 col-md-8 col-sm-8col-xs-8 padding-zero mobileview-col-xs-4">
                                    <div class="first_right_side">
                                        @Html.TextBoxFor(m => m.PVHeader.PriceTier, new { style = "width:250px; padding-bottom: 8px;", @readonly = "true" })
                                        @Html.TextAreaFor(m => m.PVHeader.Description, new
                                   {
                                       @readonly = "true",
                                       @placeholder = "Free Text (Max 30 Characters)",
                                       @rows = "2",
                                       @cols = "25",
                                       @maxlength = "30",
                                       style = "width:228px;height: 54px;"
                                   })
                                    </div>
                                </div>

                            </div>






                        </div>
                        <div class="row col">
                            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                                <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(3)" id="btnSelectionAccount">Selection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="left-side-bar for-order-margin">
                <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="chkBoxSelectAll"></th>
                            <th>No</th>
                            <th>Item Type</th>
                            <th>Item Selection</th>
                            <th>Item Name</th>
                            <th style="width: 85px;">Current Price (VEP)</th>
                            <th style="width: 85px;">New Price (VEP)</th>
                            <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                            <th style="width: 85px;">Discount</th>
                            <th style="width: 85px;">%Discount</th>
                            <th style="width: 92px;">Expected Volume (PC)</th>
                            @*<th><img src="/AcxiomDesign/images/right_icon.png" onclick="UpdateAllLineStatus('6', '@Model.PVHeader.ENTITYID')"></th>
                                <th><img src="/AcxiomDesign/images/close_red.png" onclick="UpdateAllLineStatus('7', '@Model.PVHeader.ENTITYID')"></th>*@
                           
                            <th style="text-align: left;padding-left:25px; cursor: pointer;"><i class="fa-solid fa-circle-check fa-2x" onclick="UpdateAllLineStatus('6', '@Model.PVHeader.ENTITYID')"></i></th>
                            <th style="text-align: left; padding-left:21px;  cursor: pointer;"><i class="fa-regular fa-circle-xmark fa-2x" onclick="UpdateAllLineStatus('7', '@Model.PVHeader.ENTITYID')"></i></th>

                        </tr>
                    </thead>
                    @*<tbody style="background-color: #dee0df;">*@
                    <tbody>
                        @if (Model != null)
                        {
                            foreach (PVFLine d in Model.PVLine)
                            {
                                <tr>
                                    <td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></td>
                                    <td>@d.No</td>
                                    <td>@d.ItemTypeDesc</td>
                                    <td>@d.ItemSelection</td>
                                    <td>@d.ItemName</td>
                                    <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                    <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                    <td>@d.DiscountPer<span> % </span></td>
                                    <td>@d.ExpectedVolumn</td>
                                    @if (@d.ISAPPROVE == 0)
                                    {
                                        isapprove = true;

                                    }
                                    else if (@d.ISAPPROVE == 1)
                                    {
                                        isreject = true;

                                    }
                                    else
                                    {
                                        isapprove = false;
                                        isreject = false;
                                    }
                                    <td>
                                        @if (@d.ISAPPROVE == 0)
                                        {
                                            <button class="btnlineStatusApp" onclick="UpdateLineStatus('6','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">APPROVE</button>

                                        }
                                        else
                                        {
                                            <button class="btnlineStatusAppGray" onclick="UpdateLineStatus('6','@d.ItemSelection' ,'@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">APPROVE</button>
                                        }

                                    </td>
                                    <td>
                                        @if (@d.ISAPPROVE == 1)
                                        {
                                            <button class="btnlineStatusRej" onclick="UpdateLineStatus('7','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">REJECT</button>

                                        }
                                        else
                                        {

                                            <button class="btnlineStatusRejGray" onclick="UpdateLineStatus('7','@d.ItemSelection', '@Model.PVHeader.ENTITYID')" type="button" id="btnstatusline">REJECT</button>

                                        }


                                    </td>

                                </tr>

                            }
                        }


                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>

            </div>

            <br>
            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(3)" id="btnSelectionItem">Selection</button>
            </div>
            <br>
            <br>
            <div class="for-top-border">
                <div class="row col">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @maxlength = "30" })
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">

                        @if (isreject)
                        {
                            <button class="btnSave_RequestChange" type="button" onclick="UpdateHeaderStatus('0','3','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                        }
                        else
                        {
                            <button class="btnSave_RequestChange" style="display: none;" type="button" onclick="UpdateHeaderStatus('0','3','@Model.PVHeader.ENTITYID')" id="btnRequestchnage">Request for Change</button>
                        }
                    </div>
                </div>
            </div>

            <div class="for-bg-color">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-3 col-md-4 col-sm-4 col-xs-16">
                            <div class="middel-center">
                                <p>Attachment :</p>
                            </div>

                            <div class="right-middel">
                                @{
                                    for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                    {
                                        string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                        if (ext.ToUpper() == ".PDF")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                                <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".DOCX")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                                <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                                <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".XLSX")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                                <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                            </a>

                                        }

                                    }
                                }
                            </div>


                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-16">
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">

                            <div class="right-middel">
                                @if (isreject && isapprove == false)
                                {
                                    <button style="margin-left: 20px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','7', '@Model.PVHeader.ENTITYID');">Reject</button>
                                }
                                else
                                {<button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','7', '@Model.PVHeader.ENTITYID');">Reject</button>}
                            </div>
                            <div class="right-middel">
                                @if (isapprove && isreject == false)
                                {
                                    <button style="margin-left: 20px;  margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','6', '@Model.PVHeader.ENTITYID');">Approve</button>
                                }
                                else
                                {
                                    <button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','6', '@Model.PVHeader.ENTITYID');">Approve</button>
                                }
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        }

        else if (Model.PVHeader.HeaderStatus == 6)//for release user
        {

            <div class="loader_overlay">
                <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
            </div>
            <div class="wrapperbox">
                <div class="top-title">
                    <h2>Price Approval Form</h2>


                    <div style="margin-bottom:29px">
                        @if (Model.PVHeader.PVCNO == "")
                        {
                            <button class="btnSave_pvc" type="submit" onclick="SavePVCData()" id="btnsavePVC">Save</button>
                        }
                        else
                        {
                            <button class="btnSave_pvc" type="submit" onclick="UpdatePVCDataRelease()" id="btnUpdatePVC">Update</button>
                            <button class="btnSave_pvc" style="display:none" onclick="Unabledisabledfield()" type="button" id="btnEditpvc">Edit</button>
                        }
                        <span id="Pvnumber" class="for_PVCNumSeq">@ViewBag.PVCNUMSEQ</span><span class="for_PVCNumSeq"> PV No :-</span>

                    </div>


                </div>

                <div class="for-top-border">
                    <div class="container" style="width:1315px">
                        <div class="row">
                            <div style="width: 38%;">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                    <div class="first_left_side mobileview-col-xs-6">
                                        <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_left_side for-float-right">
                                        @Html.DropDownListFor(m => m.PVHeader.ENTITYID, ViewBag.EntityDropdown as SelectList, new
                                        {
                                            @id = "PVHeader_Entity",
                                       @class = "searchable",
                                            style = "width:250px",
                                       @onchange = "OnEnityChange();"
                                   })
                                        @Html.DropDownListFor(m => m.PVHeader.CUSTAPPLICABLETYPEID, ViewBag.CustomerApplicableDropdown as SelectList, new
                                   {
                                       @id = "PVHeader_CustomerApplicable",
                                       @value = Model.PVHeader.CustomerApplicable,
                                       @class = "searchable",
                                       style = "width:250px",
                                       @onchange = "CustomerApplicablechange();"
                                   })
                                        @if (ViewBag.AccountSelection as SelectList == null)
                                        {
                                            @Html.DropDownListFor(m => m.PVHeader.AccountSelection, Enumerable.Empty<SelectListItem>(),
        new { @id = "PVHeader_AccountSelection", @value = Model.PVHeader.AccountSelection, @class = "searchable", style = "width:250px", multiple = "multiple" })
                                        }
                                        else
                                        {
                                            @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                       {
                                           @id = "PVHeader_AccountSelection",
                                           @value = Model.PVHeader.AccountSelection,
                                           @class = "searchable",
                                           style = "width:250px",
                                           multiple = "multiple"
                                       })
                                        }

                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">

                                <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                        <p>@Html.Label("Start Date")</p>
                                        <p>@Html.Label("End Date")</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-8 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_right_side">
                                        @Html.DropDownListFor(m => m.PVHeader.BranchWithVat, ViewBag.BranchDropdown as SelectList,
                                        new { @id = "PVHeader_Branch", @class = "searchable", style = "width:195px", @onchange = "BranchChange();" })

                                        @if (Model.PVLine.Count > 0)
                                        {
                                            isdatecheck = true;
                                            <div style="padding-top: 8px;">
                                                @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @id = "StartDate", style = "width:170px" })
                                            </div>
                                            @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:170px" })

                                        }
                                        else
                                        {
                                            <div style="padding-top: 8px;">
                                                @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @id = "StartDate", style = "width:200px;padding-left: 9px;" })
                                            </div>
                                            @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:200px" })
                                        }
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                    <div class="first_right_side">
                                        <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                        <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                    </div>
                                </div>

                                <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                    <div class="first_right_side">
                                        @Html.DropDownListFor(m => m.PVHeader.TIERID, ViewBag.PriceTierDropdown as SelectList,
        new { @id = "PVHeader_PriceTier", @class = "searchable", style = "width:260px" })
                                        @Html.TextAreaFor(m => m.PVHeader.Description, new
                                   {
                                       @placeholder = "Free Text (Max 30 Characters)",
                                       @rows = "2",
                                       @cols = "25",
                                       @maxlength = "30",
                                       style = "width:260px;height: 55px;"
                                   })
                                    </div>
                                </div>

                            </div>




                        </div>
                        <div class="row col">
                            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                                <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(4)" id="btnSelectionAccount">Selection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="left-side-bar for-order-margin">
                <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="chkBoxSelectAll"></th>
                            <th>No</th>
                            <th>Item Type</th>
                            <th>Item Selection</th>
                            <th>Item Name</th>
                            <th style="width: 85px;">Current Price (VEP)</th>
                            <th style="width: 82px;">New Price (VEP)</th>
                            <th style="width: 82px;">New Price (VIP)</th>
                            <th style="width: 75px;">Discount</th>
                            <th style="width: 85px;">%Discount</th>
                            <th style="width: 85px;">Expected Volume (PC)</th>
                            <th style="width: 75px"></th>
                            <th style="width: 45px"></th>
                            @*<th><i class="fa-solid fa-circle-plus fa-2x" style="cursor: pointer;" onclick="AddPvcItemline(2);"></i></th>
                            <th><i class="fa-solid fa-circle-minus fa-2x" style="cursor: pointer;" onclick="RemovePVLine(2)"></i></th>*@



                        </tr>
                    </thead>
                    @*<tbody style="background-color: #d6d4d2;">*@
                    <tbody style="background-color: #dee0df;">
                        @if (Model != null)
                        {
                            PVFLine d = new PVFLine();
                            <tr>
                                <td><span class="mobile-before-label"></span></td>
                                <td><span class="mobile-before-label"></span></td>
                                <td><span class="mobile-before-label"></span>@Html.DropDownListFor(m => d.ItemType, ViewBag.ItemType as SelectList, new { @style = "width:150px", @class = "searchable", @onchange = "ItemTypeChange();" })</td>

                                <td><span class="mobile-before-label"></span>@Html.DropDownList("drpItemSelection", new SelectList(Enumerable.Empty<SelectListItem>()), new { @style = "width:200px", @class = "tabel_text_box searchable", @onchange = "ItemSelectionchnage();" })</td>
                                <td><span class="mobile-before-label"></span>@Html.TextBoxFor(m => d.ItemName, new { @class = "", @readonly = "true", @style = "width:190px; font-size: 12px;" })</td>
                                <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("CurrentPriceVEP", null, new { @id = "d_CurrentPriceVEP", @class = "allow_numeric", @onchange = "addZero();CalculateDiscount();", @style = "width:46px; font-size: 12px;" })</td>
                                <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("NewPriceVEP", null, new { @id = "d_NewPriceVEP", @class = "allow_numeric", @onchange = "addZero();CalculateDiscount();", @style = "width:46px; font-size: 12px;" })</td>
                                <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("NewPriceVIP", null, new { @id = "d_NewPriceVIP", @style = "width:50px; font-size: 12px;", @readonly = "true" })</td>
                                <td><span class="mobile-before-label"></span><span class="for_AmountSign">$</span>@Html.TextBox("Discount", null, new { @id = "d_Discount", @readonly = "true", @style = "width:40px; font-size: 12px;" })</td>
                                <td><span class="mobile-before-label"></span>@Html.TextBoxFor(m => d.DiscountPer, new { @readonly = "true", @style = "width:40px; font-size: 12px; margin-left: 5px;" })<span> % </span></td>
                                <td><span class="mobile-before-label"></span>@Html.TextBox("ExpectedVolumn", null, new { @id = "d_ExpectedVolumn", @class = "dontallow_decimal", @style = "width:80px; font-size: 12px;" })</td>

                                <td><i class="fa-solid fa-circle-plus fa-2x" style="cursor: pointer;" onclick="AddPvcItemline(2);"></i></td>
                                <td><i class="fa-solid fa-circle-minus fa-2x" style="cursor: pointer;" onclick="RemovePVLine(2)"></i></td>
                            </tr>

                        }

                    </tbody>
                    <tfoot>

                        @foreach (PVFLine line in Model.PVLine)
                        {
                          
                                <tr>
                                    <td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></td>
                                    <td>@line.No</td>
                                    <td>@line.ItemTypeDesc</td>
                                    <td id="ItemSelection_@line.No">@line.ItemSelection</td>
                                    <td>@line.ItemName</td>
                                    <td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span>@Html.TextBoxFor(m => line.CurrentPriceVEP, new { @id = "CurrentPriceVEP_" + line.No, @class = "allow_numeric", @onchange = "CalculateDiscountChange('" + line.No + "');", @style = "height: 17px;width:45px; font-size: 12px;" })</td>
                                    <td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span>@Html.TextBoxFor(m => line.NewPriceVEP, new { @id = "NewPriceVEP_" + line.No, @class = "allow_numeric", @onchange = "CalculateDiscountChange('" + line.No + "');", @style = "height:17px;width:45px; font-size: 12px;" })</td>
                                    <td id="NewPriceVIP_@line.No"><span class="for_AmountSign">$ </span>@line.NewPriceVIP</td>
                                    <td id="Discount_@line.No"><span class="for_AmountSign">$ </span>@line.Discount</td>
                                    <td id="DiscountPer_@line.No">@line.DiscountPer<span> % </span></td>
                                    <td><span class="mobile-before-label"></span>@Html.TextBoxFor(m => line.ExpectedVolumn, new { @id = "ExpectedVolumn_" + @line.No, @class = "dontallow_decimal", @onchange = "EnterVolumn('" + line.No + "');", @style = "height: 17px;width:80px; font-size: 12px;" })</td>
                                    <td><button class="btn-btnPopup" id="btnUpdateline_@line.No" type="button" style="width:77px;display:none" accesskey="A" onclick="updatelineData(@line.No,1)">Update</button></td>
                                    <td></td>
                                </tr>
                            
                        }
                    </tfoot>
                </table>

            </div>


            <br>
            <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(4)" id="btnSelectionItem">Selection</button>
            </div>
            <br>
            <br>
            <div class="for-top-border">
                <div class="row col">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true" })
                        </div>
                    </div>

                </div>
            </div>

            <div class="for-bg-color">
                <div class="col">
                    <div class="row">

                        <div class="col-lg-3 col-md-4 col-sm-4 col-xs-16">
                            <div class="middel-center">
                                <p>Attachment :</p>
                            </div>
                            <div class="right-middel">
                                @{
                                    for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                    {
                                        string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                        if (ext.ToUpper() == ".PDF")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                                <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".DOCX")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                                <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                                <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                            </a>

                                        }
                                        else if (ext.ToUpper() == ".XLSX")
                                        {
                                            <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                                <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                            </a>

                                        }

                                    }
                                }
                            </div>

                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-16">

                            @if (!Model.PVHeader.ISPOSTPRICE)
                            {

                                if (Model._syncbutton.ShowItemSelectionbtn)
                                {
                                    <div class="right-middel">
                                        <button style="margin-left: 20px;  margin-bottom: 5px;" type="button" id="btnSyncItemSelection" accesskey="A" onclick="SyncSelectiontoAx('@Model.PVHeader.PVCNO','2')">Sync Item Selection</button>
                                    </div>
                                }
                                if (Model._syncbutton.ShowAccountSelectionbtn)
                                {

                                    <div class="right-middel">

                                        <button style="margin-left: 20px; margin-bottom: 5px;" type="button" accesskey="A" id="btnSyncAccountSelection" onclick="SyncSelectiontoAx('@Model.PVHeader.PVCNO','1')">Sync Account Selection</button>

                                    </div>
                                }
                            }
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">

                            <div class="right-middel">
                                @if (Model.PVHeader.ISPOSTPRICE)
                                {
                                    <button style="margin-left: 20px;  margin-bottom: 5px;" type="button" accesskey="A" id="btnReleaseHistory" onclick="ReleaseData(0);">Save to History</button>
                                }
                                else
                                {
                                    <button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" accesskey="A" id="btnReleaseMSD" onclick="ReleaseData(1);">Release to MSD</button>
                                }
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        }

    }
}
else
{
    <!-----Account Selection-->
    <div class="Selection-Account" id="SelectionAccountPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeSelectionAccount()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                <div class="row">
                    <button class="btn-btnPopup" style="margin-left: 20px; margin-bottom: 10px;" id="btnApplicants" type="button" accesskey="A" onclick="OpenApplicantsPopup()">Applicants</button>

                </div>


            </div>


            <table id="pvcAccountSelection" style="width: 50%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table pvcAccountSelection">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkAccountSelection"></th>
                        <th>Account Selection</th>
                        <th>Account Name</th>
                    </tr>

                </thead>
                <tbody>
                </tbody>
                <tfoot>

                </tfoot>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="CustDetailsPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeApplicantsPopup()" title="Close">


            <table id="tblpvcCustDetails" style="width: 70%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table tblpvcCustDetails">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkCustAccountSelection"></th>
                        <th>Customer Account</th>
                        <th>Customer Name</th>
                    </tr>

                </thead>
                <tbody>
                </tbody>
            </table>

        </div>
    </div>


    <!-----End-->
    <!-----Item Selection-->
    <div class="Selection-Account" id="SelectionItemPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeSelectionItem()" title="Close">

            <div style="margin:11px" class="col-lg-11 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                <div class="row">
                    <button class="btn-btnPopup" style="margin-left: 20px; margin-bottom: 10px;" id="btnitemApplicants" type="button" accesskey="A" onclick="OpenItemsDetailsPopup()">Items</button>

                </div>


            </div>


            <table id="pvcItemSelection" style="width:70%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table pvcItemSelection">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkitemSelection"></th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>

                </tfoot>
            </table>

        </div>
    </div>

    <div class="Selection-Account" id="itemDetailsPopup">
        <div class="Selection-AccountPopup">

            <img src="~/AcxiomDesign/images/close_red.png" class="closepopup" onclick="closeItemsDetailsPopup()" title="Close">

            <table id="tblpvcitemDetails" style="width: 60%; margin-left: 15px" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table tblpvcitemDetails">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="itemdetailschkbox()" id="chkitemdetailsSelection"></th>
                        <th>Item Number</th>
                        <th>Product Name</th>
                    </tr>

                </thead>
                <tbody>
                </tbody>
            </table>

        </div>
    </div>


    <!-----end-->


//

    if (Model.PVHeader.HeaderStatus == 1)
    {



        <div class="loader_overlay">
            <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
        </div>

        <div class="wrapperbox">
            <div class="top-title">
                <h2>Price Approval Form</h2>


                <div style="margin-bottom:29px">
                    <button class="btnSave_pvc" type="submit" onclick="UpdatePVCDataApproval()" id="btnUpdatePVC">Update</button>
                    <span id="Pvnumber" class="for_PVCNumSeq">@ViewBag.PVCNUMSEQ</span><span class="for_PVCNumSeq"> PV No :-</span>

                </div>


            </div>

            <div class="for-top-border">
                <div class="container" style="width:1315px">
                    <div class="row">
                        <div style="width: 38%;">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                <div class="first_left_side mobileview-col-xs-6">
                                    <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_left_side for-float-right">
                                    @Html.DropDownListFor(m => m.PVHeader.ENTITYID, ViewBag.EntityDropdown as SelectList, new
                                    {
                                        @id = "PVHeader_Entity",
                                   @class = "searchable",
                                        style = "width:250px",
                                   @onchange = "OnEnityChange();",
                                   @disabled = "disabled"
                               })
                                    @Html.DropDownListFor(m => m.PVHeader.CUSTAPPLICABLETYPEID, ViewBag.CustomerApplicableDropdown as SelectList, new
                               {
                                   @id = "PVHeader_CustomerApplicable",
                                   @value = Model.PVHeader.CustomerApplicable,
                                   @class = "searchable",
                                   style = "width:250px",
                                   @onchange = "CustomerApplicablechange();",
                                   @disabled = "disabled"
                               })
                                    @if (ViewBag.AccountSelection as SelectList == null)
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.AccountSelection, Enumerable.Empty<SelectListItem>(),
    new { @id = "PVHeader_AccountSelection", @value = Model.PVHeader.AccountSelection, @class = "searchable", @disabled = "disabled", style = "width:250px", multiple = "multiple" })
                                    }
                                    else
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                   {
                                       @id = "PVHeader_AccountSelection",
                                       @value = Model.PVHeader.AccountSelection,
                                       @class = "searchable",
                                       style = "width:250px",
                                       multiple = "multiple",
                                       @disabled = "disabled"
                                   })
                                    }

                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">

                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                    <p>@Html.Label("Start Date")</p>
                                    <p>@Html.Label("End Date")</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.BranchWithVat, ViewBag.BranchDropdown as SelectList,
                                    new { @id = "PVHeader_Branch", @class = "searchable", @disabled = "disabled", style = "width:195px", @onchange = "BranchChange();" })

                                    @if (Model.PVLine.Count > 0)
                                    {
                                        isdatecheck = true;
                                        <div style="padding-top: 8px;">
                                            @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @disabled = "disabled", @id = "StartDate", style = "width:170px" })
                                        </div>
                                        @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:170px" })

                                    }
                                    else
                                    {
                                        <div style="padding-top: 8px;">
                                            @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @disabled = "disabled", @id = "StartDate", style = "width:200px;padding-left: 9px;" })
                                        </div>
                                        @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:200px" })
                                    }
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.TIERID, ViewBag.PriceTierDropdown as SelectList,
    new { @id = "PVHeader_PriceTier", @class = "searchable", style = "width:260px", @disabled = "disabled" })
                                    @Html.TextAreaFor(m => m.PVHeader.Description, new
                               {
                                   @placeholder = "Free Text (Max 30 Characters)",
                                   @rows = "2",
                                   @cols = "25",
                                   @maxlength = "30",
                                   style = "width:260px;height: 55px;"
                               })
                                </div>
                            </div>

                        </div>




                    </div>
                    <div class="row col">
                        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                            <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(1)" id="btnSelectionAccount">Selection</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="left-side-bar for-order-margin">
            <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkBoxSelectAll"></th>
                        <th>No</th>
                        <th>Item Type</th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                        <th style="width: 85px;">Current Price (VEP)</th>
                        <th style="width: 85px;">New Price (VEP)</th>
                        <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                        <th style="width: 85px;">Discount</th>
                        <th style="width: 85px;">%Discount</th>
                        <th style="width: 92px;">Expected Volume (PC)</th>
                    </tr>
                </thead>
                <tfoot>
                    @if (Model != null)
                    {
                        foreach (PVFLine d in Model.PVLine)
                        {
                            <tr>

                                <td></td>
                                <td>@d.No</td>
                                <td>@d.ItemTypeDesc</td>
                                <td>@d.ItemSelection</td>
                                <td>@d.ItemName</td>
                                <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                <td>@d.DiscountPer<span> % </span></td>
                                <td>@d.ExpectedVolumn</td>
                            </tr>

                        }
                    }


                </tfoot>

            </table>

        </div>

        <br>
        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
            <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(1)" id="btnSelectionItem">Selection</button>
        </div>
        <br>
        <br>
        <div class="for-top-border">
            <div class="col">
                <div class="row">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true", @maxlength = "30" })
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    </div>

                </div>
            </div>
        </div>

        <div class="for-bg-color">
            <div class="container">
                <div class="row">

                    <div class="col-lg-10 col-md-5 col-sm-5 col-xs-16">
                        <div class="middel-center">
                            <p>Upload Attachment :</p>
                        </div>
                        <div id="divImgUpload" class="right-delete">
                            @{
                                for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                {
                                    string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                    if (ext.ToUpper() == ".PDF")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".DOCX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                    {

                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".XLSX")
                                    {

                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                        </a>

                                    }

                                }
                            }

                        </div>

                    </div>

                    <div class="col-lg-2 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">

                        <div class="right-middel">
                            <button style="margin-left: 20px; height: 33px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','3', '@Model.PVHeader.ENTITYID');">Reject</button>
                        </div>
                        <div class="right-middel">
                            <button style="height: 33px; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','2', '@Model.PVHeader.ENTITYID');">Approve</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <br>


    }

    else if (Model.PVHeader.HeaderStatus == 2)// 2nd Approver screen
    {
        <input type="hidden" value="@Model.PVHeader.CUSTAPPLICABLETYPEID" id="PVHeader_CustomerApplicable">
        <div class="loader_overlay">
            <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
        </div>

        <div class="wrapperbox">
            <div class="top-title">
                <h2>Price Approval Form</h2>

                <div style="margin-bottom:29px">
                    <span id="Pvnumber" class="for_PVCNumSeq">@Model.PVHeader.PVCNO</span><span class="for_PVCNumSeq"> PV No :-</span>

                </div>

            </div>
            <div class="for-top-border">
                <div class="container" style="width:1315px">
                    <div class="row">
                        <div style="width: 38%;">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                <div class="first_left_side mobileview-col-xs-6">
                                    <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_left_side for-float-right">
                                    @Html.TextBoxFor(m => m.PVHeader.Entity, new { style = "width:250px", @readonly = "true" })
                                    @Html.TextBoxFor(m => m.PVHeader.CustomerApplicable, new { style = "width:250px", @id = "customerapplicable", @readonly = "true" })
                                    @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                               {
                                   @id = "PVHeader_AccountSelection",
                                   @value = Model.PVHeader.AccountSelection,
                                   @class = "searchable",
                                   style = "width:250px",
                                   multiple = "multiple"

                               })
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">
                            <div class="col-lg-3 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                    <p>@Html.Label("Start Date")</p>
                                    <p>@Html.Label("End Date")</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-9 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.TextBoxFor(m => m.PVHeader.Branch, new { style = "width:170px; padding-bottom: 8px;", @readonly = "true" })
                                    @if (Model.PVLine.Count > 0)
                                    {
                                        isdatecheck = true;
                                        @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                        @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                    }
                                    else
                                    {
                                        @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                        @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                    }
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                            <div class="col-md-4 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                </div>
                            </div>

                            <div class="col-md-8 col-md-8 col-sm-8col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    @Html.TextBoxFor(m => m.PVHeader.PriceTier, new { style = "width:250px; padding-bottom: 8px;", @readonly = "true" })
                                    @Html.TextAreaFor(m => m.PVHeader.Description, new
                               {
                                   @readonly = "true",
                                   @placeholder = "Free Text (Max 30 Characters)",
                                   @rows = "2",
                                   @cols = "25",
                                   @maxlength = "30",
                                   style = "width:228px;height: 54px;"
                               })
                                </div>
                            </div>

                        </div>






                    </div>
                    <div class="row col">
                        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                            <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(2)" id="btnSelectionAccount">Selection</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="left-side-bar for-order-margin">
            <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkBoxSelectAll"></th>
                        <th>No</th>
                        <th>Item Type</th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                        <th style="width: 85px;">Current Price (VEP)</th>
                        <th style="width: 85px;">New Price (VEP)</th>
                        <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                        <th style="width: 85px;">Discount</th>
                        <th style="width: 85px;">%Discount</th>
                        <th style="width: 92px;">Expected Volume (PC)</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (PVFLine d in Model.PVLine)
                        {
                            <tr>

                                <td></td>
                                <td>@d.No</td>
                                <td>@d.ItemTypeDesc</td>
                                <td>@d.ItemSelection</td>
                                <td>@d.ItemName</td>
                                <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                <td>@d.DiscountPer<span> % </span></td>
                                <td>@d.ExpectedVolumn</td>
                            </tr>

                        }
                    }


                </tbody>
                <tfoot>
                </tfoot>
            </table>

        </div>

        <br>
        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
            <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(2)" id="btnSelectionItem">Selection</button>
        </div>
        <br>
        <br>
        <div class="for-top-border">
            <div class="col">
                <div class="row">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true", @maxlength = "30" })
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                    </div>

                </div>
            </div>
        </div>

        <div class="for-bg-color">
            <div class="container">
                <div class="row">

                    <div class="col-lg-9 col-md-4 col-sm-4 col-xs-16">
                        <div class="middel-center">
                            <p>Attachment :</p>
                        </div>
                        <div class="right-middel">
                            @{
                                for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                {
                                    string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                    if (ext.ToUpper() == ".PDF")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".DOCX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".XLSX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                        </a>

                                    }

                                }
                            }
                        </div>

                    </div>

                    <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">

                        <div class="right-middel">
                            <button style="margin-left: 20px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','5', '@Model.PVHeader.ENTITYID');">Reject</button>
                        </div>

                        <div class="right-middel">
                            <button style="margin-left: 20px; margin-bottom: 5px;" type="button" accesskey="A" onclick="UpdateHeaderStatus('3','0', '@Model.PVHeader.ENTITYID');">Escalate</button>
                        </div>

                        <div class="right-middel">

                            <button style="margin-left: 20px; margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','4', '@Model.PVHeader.ENTITYID');">Approve</button>

                        </div>


                    </div>
                </div>
            </div>
        </div>

    }

    else if (Model.PVHeader.HeaderStatus == 4)// 3rd Approver
    {
        <input type="hidden" value="@Model.PVHeader.CUSTAPPLICABLETYPEID" id="PVHeader_CustomerApplicable">
        <div class="loader_overlay">
            <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
        </div>

        <div class="wrapperbox">
            <div class="top-title">
                <h2>Price Approval Form</h2>

                <div style="margin-bottom:29px">
                    <span id="Pvnumber" class="for_PVCNumSeq">@Model.PVHeader.PVCNO</span><span class="for_PVCNumSeq"> PV No :-</span>

                </div>

            </div>
            <div class="for-top-border">
                <div class="container" style="width:1315px">
                    <div class="row">
                        <div style="width: 38%;">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                <div class="first_left_side mobileview-col-xs-6">
                                    <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_left_side for-float-right">
                                    @Html.TextBoxFor(m => m.PVHeader.Entity, new { style = "width:250px", @readonly = "true" })
                                    @Html.TextBoxFor(m => m.PVHeader.CustomerApplicable, new { style = "width:250px", @id = "customerapplicable", @readonly = "true" })
                                    @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                               {
                                   @id = "PVHeader_AccountSelection",
                                   @value = Model.PVHeader.AccountSelection,
                                   @class = "searchable",
                                   style = "width:250px",
                                   multiple = "multiple"

                               })
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">
                            <div class="col-lg-3 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                    <p>@Html.Label("Start Date")</p>
                                    <p>@Html.Label("End Date")</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-9 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.TextBoxFor(m => m.PVHeader.Branch, new { style = "width:170px; padding-bottom: 8px;", @readonly = "true" })
                                    @if (Model.PVLine.Count > 0)
                                    {
                                        isdatecheck = true;
                                        @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                        @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                    }
                                    else
                                    {
                                        @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "StartDate", style = "width:170px;" })
                                        @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @readonly = "true", @id = "EndDate", style = "width:170px;" })
                                    }
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                            <div class="col-md-4 col-md-1 col-sm-1 col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                </div>
                            </div>

                            <div class="col-md-8 col-md-8 col-sm-8col-xs-8 padding-zero mobileview-col-xs-4">
                                <div class="first_right_side">
                                    @Html.TextBoxFor(m => m.PVHeader.PriceTier, new { style = "width:250px; padding-bottom: 8px;", @readonly = "true" })
                                    @Html.TextAreaFor(m => m.PVHeader.Description, new
                               {
                                   @readonly = "true",
                                   @placeholder = "Free Text (Max 30 Characters)",
                                   @rows = "2",
                                   @cols = "25",
                                   @maxlength = "30",
                                   style = "width:228px;height: 54px;"
                               })
                                </div>
                            </div>

                        </div>






                    </div>
                    <div class="row col">
                        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                            <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(3)" id="btnSelectionAccount">Selection</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="left-side-bar for-order-margin">
            <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkBoxSelectAll"></th>
                        <th>No</th>
                        <th>Item Type</th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                        <th style="width: 85px;">Current Price (VEP)</th>
                        <th style="width: 85px;">New Price (VEP)</th>
                        <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                        <th style="width: 85px;">Discount</th>
                        <th style="width: 85px;">%Discount</th>
                        <th style="width: 92px;">Expected Volume (PC)</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (PVFLine d in Model.PVLine)
                        {
                            <tr>

                                <td></td>
                                <td>@d.No</td>
                                <td>@d.ItemTypeDesc</td>
                                <td>@d.ItemSelection</td>
                                <td>@d.ItemName</td>
                                <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                <td>@d.DiscountPer<span> % </span></td>
                                <td>@d.ExpectedVolumn</td>
                            </tr>

                        }
                    }


                </tbody>
                <tfoot>
                </tfoot>
            </table>

        </div>

        <br>
        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
            <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(3)" id="btnSelectionItem">Selection</button>
        </div>
        <br>
        <br>
        <div class="for-top-border">
            <div class="col">
                <div class="row">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true", @maxlength = "30" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @maxlength = "30" })
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="for-bg-color">
            <div class="container">
                <div class="row">

                    <div class="col-lg-10 col-md-4 col-sm-4 col-xs-16">
                        <div class="middel-center">
                            <p>Attachment :</p>
                        </div>

                        <div class="right-middel">
                            @{
                                for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                {
                                    string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                    if (ext.ToUpper() == ".PDF")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".DOCX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".XLSX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                        </a>

                                    }

                                }
                            }
                        </div>


                    </div>

                    <div class="col-lg-2 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">
                        <div class="right-middel">
                            <button style="margin-left: 20px; margin-bottom: 5px;" type="button" id="btnReject" accesskey="A" onclick="UpdateHeaderStatus('2','7', '@Model.PVHeader.ENTITYID');">Reject</button>
                        </div>
                        <div class="right-middel">
                            <button style="margin-bottom: 5px;" type="button" accesskey="A" id="btnApprove" onclick="UpdateHeaderStatus('1','6', '@Model.PVHeader.ENTITYID');">Approve</button>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    }

    else if (Model.PVHeader.HeaderStatus == 6)//for release user
    {

        <div class="loader_overlay">
            <img src="~/AcxiomDesign/images/Loading-red.gif" id="loading" height="250px" width="250px" />
        </div>
        <div class="wrapperbox">
            <div class="top-title">
                <h2>Price Approval Form</h2>


                <div style="margin-bottom:29px">
                    <button class="btnSave_pvc" type="submit" onclick="UpdatePVCDataApproval()" id="btnUpdatePVC">Update</button>
                    <span id="Pvnumber" class="for_PVCNumSeq">@ViewBag.PVCNUMSEQ</span><span class="for_PVCNumSeq"> PV No :-</span>

                </div>


            </div>

            <div class="for-top-border">
                <div class="container" style="width:1315px">
                    <div class="row">
                        <div style="width: 38%;">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4">
                                <div class="first_left_side mobileview-col-xs-6">
                                    <p>@Html.LabelFor(m => m.PVHeader.Entity)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.CustomerApplicable)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.AccountSelection)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_left_side for-float-right">
                                    @Html.DropDownListFor(m => m.PVHeader.ENTITYID, ViewBag.EntityDropdown as SelectList, new
                               {
                                   @id = "PVHeader_Entity",
                                   @class = "searchable",
                                   @disabled = "disabled",
                                   style = "width:250px",
                                   @onchange = "OnEnityChange();"
                               })
                                    @Html.DropDownListFor(m => m.PVHeader.CUSTAPPLICABLETYPEID, ViewBag.CustomerApplicableDropdown as SelectList, new
                               {
                                   @id = "PVHeader_CustomerApplicable",
                                   @value = Model.PVHeader.CustomerApplicable,
                                   @class = "searchable",
                                   style = "width:250px",
                                   @disabled = "disabled",
                                   @onchange = "CustomerApplicablechange();"
                               })
                                    @if (ViewBag.AccountSelection as SelectList == null)
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.AccountSelection, Enumerable.Empty<SelectListItem>(),
    new { @id = "PVHeader_AccountSelection", @value = Model.PVHeader.AccountSelection, @disabled = "disabled", @class = "searchable", style = "width:250px", multiple = "multiple" })
                                    }
                                    else
                                    {
                                        @Html.DropDownListFor(m => m.PVHeader.ACCOUNTSELECTIONID, ViewBag.AccountSelection as SelectList, new
                                   {
                                       @id = "PVHeader_AccountSelection",
                                       @value = Model.PVHeader.AccountSelection,
                                       @class = "searchable",
                                       style = "width:250px",
                                       @disabled = "disabled",
                                       multiple = "multiple"
                                   })
                                    }

                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12" style="margin-right:55px">

                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.Branch)</p>
                                    <p>@Html.Label("Start Date")</p>
                                    <p>@Html.Label("End Date")</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-2 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.BranchWithVat, ViewBag.BranchDropdown as SelectList,
                                    new { @id = "PVHeader_Branch", @disabled = "disabled", @class = "searchable", style = "width:195px", @onchange = "BranchChange();" })

                                    @if (Model.PVLine.Count > 0)
                                    {
                                        isdatecheck = true;
                                        <div style="padding-top: 8px;">
                                            @Html.TextBoxFor(m => Model.PVLine[0].StartDate, new { @class = "flatpickr flatpickr-input active", @disabled = "disabled", @id = "StartDate", style = "width:170px" })
                                        </div>
                                        @Html.TextBoxFor(m => Model.PVLine[0].EndDate, new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:170px" })

                                    }
                                    else
                                    {
                                        <div style="padding-top: 8px;">
                                            @Html.TextBox("StartDate", new { @class = "flatpickr flatpickr-input active", @disabled = "disabled", @id = "StartDate", style = "width:200px;padding-left: 9px;" })
                                        </div>
                                        @Html.TextBox("EndDate", new { @class = "flatpickr flatpickr-input active", @id = "EndDate", style = "width:200px" })
                                    }
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 mobileview-col-xs-12">
                            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 mobileview-col-xs-12">
                                <div class="first_right_side">
                                    <p>@Html.LabelFor(m => m.PVHeader.PriceTier)</p>
                                    <p>@Html.LabelFor(m => m.PVHeader.Description)</p>
                                </div>
                            </div>

                            <div class="col-xs-8 col-md-8 col-sm-3 col-xs-3 mobileview-col-xs-3">
                                <div class="first_right_side">
                                    @Html.DropDownListFor(m => m.PVHeader.TIERID, ViewBag.PriceTierDropdown as SelectList,
    new { @id = "PVHeader_PriceTier", @class = "searchable", @disabled = "disabled", style = "width:260px" })
                                    @Html.TextAreaFor(m => m.PVHeader.Description, new
                               {
                                   @placeholder = "Free Text (Max 30 Characters)",
                                   @rows = "2",
                                   @cols = "25",
                                   @maxlength = "30",
                                   style = "width:260px;height: 55px;"
                               })
                                </div>
                            </div>

                        </div>




                    </div>
                    <div class="row col">
                        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
                            <button class="btnSave_pvc btn" type="button" onclick="OpenSelectionAccount(4)" id="btnSelectionAccount">Selection</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="left-side-bar for-order-margin">
            <table id="PvcLinetbl" class="add-new-class table order_table order_table-right2 for-margin cell-border mobile_view_beforenone responsive-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="chkBoxSelectAll"></th>
                        <th>No</th>
                        <th>Item Type</th>
                        <th>Item Selection</th>
                        <th>Item Name</th>
                        <th style="width: 85px;">Current Price (VEP)</th>
                        <th style="width: 85px;">New Price (VEP)</th>
                        <th style="width: 80px; text-align: left !important;">New Price (VIP)</th>
                        <th style="width: 85px;">Discount</th>
                        <th style="width: 85px;">%Discount</th>
                        <th style="width: 92px;">Expected Volume (PC)</th>
			            <th style="width: 75px"></th>
                        <th style="width: 45px"></th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (PVFLine d in Model.PVLine)
                        {
                            <tr>

                                <td></td>
                                <td>@d.No</td>
                                <td>@d.ItemTypeDesc</td>
                                <td>@d.ItemSelection</td>
                                <td>@d.ItemName</td>
                                <td><span class="for_AmountSign">$ </span>@d.CurrentPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVEP</td>
                                <td><span class="for_AmountSign">$ </span>@d.NewPriceVIP</td>
                                <td><span class="for_AmountSign">$ </span>@d.Discount</td>
                                <td>@d.DiscountPer<span> % </span></td>
                                <td>@d.ExpectedVolumn</td>
                            </tr>

                        }
                    }


                </tbody>
                <tfoot>
                </tfoot>
            </table>

        </div>
        <br>
        <div class="col-lg-1 col-md-1 col-sm-4 col-xs-4 padding-zero mobileview-col-xs-4" style="margin-bottom:10px">
            <button class="btnSave_selection btn" type="button" onclick="OpenSelectionItem(4)" id="btnSelectionItem">Selection</button>
        </div>
        <br>
        <br>
        <div class="for-top-border">
            <div class="col">
                <div class="row">
                    <div style="padding-left: 15px;">
                        <div class="first_left_sidecomment mobileview-col-xs-6">
                            <p style="font-weight: bold; font-size: 13px;">Comments</p>
                            <p>@Html.Label("1st Approver :")</p>
                            <p>@Html.Label("2nd Approver :")</p>
                            <p>@Html.Label("3rd Approver :")</p>
                        </div>
                    </div>

                    <div class="col-xs-5 col-md-3 col-sm-3 col-xs-3 mobileview-col-xs-3">
                        <div class="first_left_sidecomment for-float-right">
                            <br>
                            @Html.TextBoxFor(m => m.PVHeader.firstApproverComment, new { style = "width:250px;height:28px;", @readonly = "true" })
                            @Html.TextBoxFor(m => m.PVHeader.secondApproverComment, new { style = "width:250px;height:24px;", @readonly = "true" })
                            @Html.TextBoxFor(m => m.PVHeader.thirdApprovercomment, new { style = "width:250px;height:20px;", @readonly = "true" })
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="for-bg-color">
            <div class="container">
                <div class="row">

                    <div class="col-lg-10 col-md-4 col-sm-4 col-xs-16">
                        <div class="middel-center">
                            <p>Attachment :</p>
                        </div>
                        <div class="right-middel">
                            @{
                                for (int i = 0; i < Model.PVHeader.PvImages.Count(); i++)
                                {
                                    string ext = Path.GetExtension(Model.PVHeader.PvImages[i].ImageUrl);
                                    if (ext.ToUpper() == ".PDF")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/pdf image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".DOCX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/word.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".JPG" || ext.ToUpper() == ".JPEG" || ext.ToUpper() == ".PNG")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">
                                            <img class="upload-image" src="~/AcxiomDesign/images/jpg-image.jpg" />
                                        </a>

                                    }
                                    else if (ext.ToUpper() == ".XLSX")
                                    {
                                        <a class="img-show" href="@Model.PVHeader.PvImages[i].ImageUrl" value="@Model.PVHeader.PvImages[i].ImageUrl" target="_blank">

                                            <img class="upload-image" src="~/AcxiomDesign/images/Excel image.jpg" />
                                        </a>

                                    }

                                }
                            }
                        </div>

                    </div>

                    <div class="col-lg-2 col-md-4 col-sm-4 col-xs-12 mobileview-col-xs-6 form-group-mobile">

                        <div class="right-middel">
                            <button style="margin-left: 20px; display: none; margin-bottom: 5px;" type="button" accesskey="A" id="btnUpdateReleaseMSD" onclick="ReleaseData(2);">Update to MSD</button>

                        </div>


                    </div>
                </div>
            </div>
        </div>
    }

}

<script type="text/javascript">


    var Accountselectionsycn = false;
    var Itemselectionsycn = false;


    $(document).ready(function ()
    {

        var ShowAccountSelectionbtn = '@Model._syncbutton.ShowAccountSelectionbtn';
        var ShowItemSelectionbtn = '@Model._syncbutton.ShowItemSelectionbtn';
        var ISEDITAFTERSYNC = '@Model.PVHeader.ISEDITAFTERAXSYNC'

        if (ShowAccountSelectionbtn == "False")
    {

        Accountselectionsycn = true;
    }
    if (ShowItemSelectionbtn == "False")
    {
        Itemselectionsycn = true;
    }
        var datacheck = '@isdatecheck'
        var postprice = '@ispostprice'

        // if post price was false then we need to set the min date  and if post price was  true then dont need to set the min date
        if (postprice == 'False')
        {
            if (datacheck == "False") {
                var check_in = flatpickr("#StartDate", { dateFormat: "d-M-Y", minDate: new Date(), defaultDate: new Date() });
                var check_out = flatpickr("#EndDate", { dateFormat: "d-M-Y", minDate: new Date(), defaultDate: new Date() });
            }
            else {

                $('#StartDate').prop('disabled', true);
                $('#EndDate').prop('disabled', true);


                if ((@headerstatus== 1 ||@headerstatus== 6) && ISEDITAFTERSYNC == "False") {
                    $('#StartDate').prop('disabled', false);
                    $('#EndDate').prop('disabled', false);
                }
                else if ((@headerstatus== 1 ||@headerstatus== 6) && ISEDITAFTERSYNC == "True") {
                    $('#EndDate').prop('disabled', false);
                }

                var check_in = flatpickr("#StartDate", { dateFormat: "d-M-Y", minDate: new Date() });
                var check_out = flatpickr("#EndDate", { dateFormat: "d-M-Y", minDate: new Date() });
            }
        }
        else
        {

           if (datacheck == "False")
           {
                var check_in = flatpickr("#StartDate", { dateFormat: "d-M-Y", defaultDate: new Date() });
                var check_out = flatpickr("#EndDate", { dateFormat: "d-M-Y", defaultDate: new Date() });
            }
            else {

                $('#StartDate').prop('disabled', true);
                $('#EndDate').prop('disabled', true);


               if ((@headerstatus== 1 ||@headerstatus== 6) && ISEDITAFTERSYNC == "False")
               {
                    $('#StartDate').prop('disabled', false);
                    $('#EndDate').prop('disabled', false);
                }
                else if ((@headerstatus== 1 ||@headerstatus== 6) && ISEDITAFTERSYNC == "True") {
                    $('#EndDate').prop('disabled', false);
                }

                var check_in = flatpickr("#StartDate", { dateFormat: "d-M-Y" });
                var check_out = flatpickr("#EndDate", { dateFormat: "d-M-Y"});
            }

        }

        var pvcaccount = '@Accountselection';
        pvcaccount = pvcaccount.split(',');
        if (pvcaccount != "" && pvcaccount != null)
        {
            for (var i = 0; i < pvcaccount.length; i++)
            {
                $("#PVHeader_AccountSelection option[value='" + pvcaccount[i] + "']").prop("selected", true);
            }
            $("#PVHeader_AccountSelection").trigger("chosen:updated");
        }

        if (@headerstatus==2||@headerstatus==4)
        {
            $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
            $('#PVHeader_AccountSelection').attr('disabled', true);
            $('#PVHeader_AccountSelection').chosen();
        }
        var CustApplicable = $('#PVHeader_CustomerApplicable').val();
        if (CustApplicable == 4)
        {
            $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
            $('#PVHeader_AccountSelection').removeAttr('multiple');
            $('#PVHeader_AccountSelection').chosen();

        }

        var $selectAll = $('#chkBoxSelectAll'); // main checkbox inside table thead

        $selectAll.on('click', function ()
        {

            $('.singlechkbox').prop('checked', this.checked);
        });

        var $selectAccountAll = $('#chkAccountSelection'); // main checkbox inside Account Selection table thead

        $selectAccountAll.on('click', function () {

            $('.singleAccountSelection').prop('checked', this.checked);
        });


        var $selectAccountAll = $('#chkCustAccountSelection'); // main checkbox customer account linking inside table thead

        $selectAccountAll.on('click', function () {

            $('.singleCustAccountSelection').prop('checked', this.checked);
        });

        var $selectitemAll = $('#chkitemSelection'); // main checkbox inside Account Selection table thead

        $selectitemAll.on('click', function () {

            $('.singleitemSelection').prop('checked', this.checked);
        });

        var $selectitemdetailsAll = $('#chkitemdetailsSelection'); // main checkbox inside Account Selection table thead

        $selectitemdetailsAll.on('click', function () {

            $('.singleitemdetailsSelection').prop('checked', this.checked);
        });


    });

    $(function CustomerApplicablechange()
    {
        var custType = $('#PVHeader_CustomerApplicable').val();
        var entityid = $('#PVHeader_Entity').val();
        if (custType != '')
        {
            $.ajax({
                type: "GET",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/GetAccountSelection?CustType=' + custType + '&Entityid=' + entityid + '',
                success: function (responsedata) {

                    $("#drpAccountSelectionPopup").empty();
                    $('#drpAccountSelectionPopup').attr('enabled', 'true').chosen("destroy");
                    var data = JSON.parse(responsedata);

                    $('#drpAccountSelectionPopup').append($("<option></option>").val('').html('Search'));
                    if (custType == "1") {
                        $.each(data, function (index, obj) {

                            $('#drpAccountSelectionPopup').append($("<option></option>").val(obj.SUBCHANNELID).html(obj.SUBCHANNELDESC));

                        });
                    }
                    else if (custType == "2") {
                        $.each(data, function (index, obj) {

                            $('#drpAccountSelectionPopup').append($("<option></option>").val(obj.CHAINID).html(obj.CHAINDESC));

                        });
                    }
                    else if (custType == "3") {
                        $.each(data, function (index, obj) {

                            $('#drpAccountSelectionPopup').append($("<option></option>").val(obj.CUSTPRICEGROUPID).html(obj.CUSTPRICEGROUPDESC));

                        });
                    }
                    else if (custType == "4") {
                        $.each(data, function (index, obj) {

                            $('#drpAccountSelectionPopup').append($("<option></option>").val(obj.AccountNum).html(obj.CUSTOMERNAME));

                        });
                    }
                    $('#drpAccountSelectionPopup').chosen();

                }
            });
        }
    })

    function OnEnityChange() {

        $('#PVHeader_Branch').attr('enabled', 'true').chosen("destroy");
        $('#PVHeader_PriceTier').attr('enabled', 'true').chosen("destroy");
        $('#PVHeader_CustomerApplicable').attr('enabled', 'true').chosen("destroy");
        $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");

        $('#PVHeader_Branch').get(0).selectedIndex = 0;
        $('#PVHeader_PriceTier').get(0).selectedIndex = 0;
        $('#PVHeader_CustomerApplicable').get(0).selectedIndex = 0;
        $("#PVHeader_AccountSelection").empty();
        $('#PVHeader_Description').val('');
         if (@ispostprice == 0)
        {
            flatpickr("#StartDate", { dateFormat: "d-M-Y", minDate: new Date(), defaultDate: new Date() });
            flatpickr("#EndDate", { dateFormat: "d-M-Y", minDate: new Date(), defaultDate: new Date() });
        }
        else
        {
            flatpickr("#StartDate", { dateFormat: "d-M-Y",defaultDate: new Date() });
            flatpickr("#EndDate", { dateFormat: "d-M-Y", defaultDate: new Date() });
        }
        $('#PVHeader_AccountSelection').chosen();
        $('#PVHeader_Branch').chosen();
        $('#PVHeader_PriceTier').chosen();
        $('#PVHeader_CustomerApplicable').chosen();
        RemoveItemslineOnEntityChange();

    }

    function RemoveItemslineOnEntityChange()
    {
        var status = 0;
        if (@headerstatus== 6) {
            status = 1
        }
        else
        {

            $('#d_ItemType').get(0).selectedIndex = -1;
            $('#drpItemSelection').attr('enabled', 'true').chosen("destroy");
            $("#drpItemSelection").empty();
            $('#drpItemSelection').chosen();
            $("#d_ItemType").chosen("destroy").chosen();
            $('#d_ItemName').val('');
            $('#d_CurrentPriceVEP').val('')
            $('#d_NewPriceVEP').val('')
            $('#d_NewPriceVIP').val('')
            $('#d_Discount').val('');
            $('#d_DiscountPer').val('');
            $('#d_ExpectedVolumn').val('');
}

        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();
        $.ajax({
            type: "POST",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/RemoveItemslineOnEntityChange?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&Status='+status+'',
            success: function (responsedata) {

                if (responsedata.success)
                {
                    $('#PvcLinetbl tfoot').empty();
                    if (@headerstatus== 6)
                    {
                        $('#PvcLinetbl tbody').empty();
                        $('#btnSyncItemSelection').css({ display: "none" });
                    }
                }
                else {
                    ShowMessage(jsondata.data);
                }

            }
        });

    }


    function BranchChange() {
        $('.loader_overlay, #loading').show();
        var newpriceVep = $('#d_NewPriceVEP').val();
        var BranchId = $('#PVHeader_Branch').val();

        if (BranchId == "") {
            ShowMessage('Please Select the Branch');
            return false;
        }
        else {

            BranchId = BranchId.split('-')[1];
            var newprice = Number((newpriceVep * BranchId / 100) + Number(newpriceVep));
            $('#d_NewPriceVIP').val(newprice.toFixed(2))
            var pvcnumber = $('#Pvnumber').text();

            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/DiscCalculateOnbranchchange?Vatper=' + BranchId + '&PVCNUM=' + pvcnumber + '&Status='+@headerstatus+'',
                success: function (responsedata) {

                    if (responsedata.success) {
                        $('#loading').hide();
                        $('.loader_overlay').fadeOut();
                        $('#PvcLinetbl tfoot').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var isapprove = false;
                        var isreject = false;
                        if (@headerstatus== "6")
                        {
                            $('#PvcLinetbl tfoot').empty();
                            $.each(jsondata, function (index, obj) {
                                if (obj.NO == undefined) {
                                    SRNO = Number(index + 1);
                                }
                                else {
                                    SRNO = obj.NO;
                                }
                                var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + SRNO + '</td><td>' + obj.ITEMTYPEDESC + '</td>';
                                newRow = newRow + '<td id="ItemSelection_' + SRNO + '" >' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "CurrentPriceVEP_' + SRNO + '" value=' + obj.CURRENTVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "NewPriceVEP_' + SRNO + '" value=' + obj.PROPOSEDVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td id="NewPriceVIP_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td id="Discount_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td id="DiscountPer_' + SRNO + '">' + obj.DISCPERCENTAGE.toFixed(1) + '<span> % </span></td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><input type="text"  class = "dontallow_decimal" style = "height: 17px;width:50px; font-size: 12px;" id= "ExpectedVolumn_' + SRNO + '" onchange = "EnterVolumn(' + SRNO + ');" value=' + obj.EXPECTEDVOL + '></input ></td >';
                                newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + SRNO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + SRNO + ',1)">Update</button></td></tr>';
                                //newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + SRNO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + SRNO + ',1)">Update</button></td><td></td><td></td></tr>';
                                $('#PvcLinetbl tfoot').append(newRow);
                            });
                        }
                        else
                        {
                            $.each(jsondata, function (index, obj) {
                                var checkbox = "";
                                var statusbuttonApp = "";
                                var statusbuttonreject = "";
                                    if (obj.ISAPPROVE == 0)
                                    {

                                        isapprove = true;
                                        statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                        statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                    }
                                    else if (obj.ISAPPROVE == 1)
                                    {
                                        isreject = true;
                                        statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                        statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                                    }
                                    else
                                    {
                                        isreject = false;
                                        isapprove = false;
                                        statusbutton = '';
                                        statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                        statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                    }
                                    checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                                var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                                newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer.toFixed(1) + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                                newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';

                                $('#PvcLinetbl tfoot').append(newRow);
                                if (isapprove && isreject == false) {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                    $("#btnApprove").css({ display: "block" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                if (isreject && isapprove == false) {
                                    $("#btnRequestchnage").css({ display: "block" });
                                    $("#btnReject").css({ display: "block" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                }

                                if (isreject) {

                                    $("#btnRequestchnage").css({ display: "block" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                }

                            });
                        }
                    }
                    else {
                        ShowMessage(responsedata.data);
                    }

                }
            });

        }

    }

    function ItemTypeChange() {

        var itemtype = $('#d_ItemType').val();
        var entityid = $('#PVHeader_Entity').val();
        if (itemtype != '') {
            $.ajax({
                type: "GET",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/GetItemSelection?itemtype=' + itemtype + '&Entityid=' + entityid + '',
                success: function (responsedata) {
                    $("#drpItemSelection").empty();
                    $('#drpItemSelection').attr('enabled', 'true').chosen("destroy");
                    var data = JSON.parse(responsedata);
                    $('#drpItemSelection').append($("<option></option>").val('').html('Select an option'));
                    $.each(data, function (index, obj) {

                        $('#drpItemSelection').append($("<option></option>").val(obj.ITEMID).html(obj.ITEMNAME));

                    });
                    $('#drpItemSelection').chosen();

                }
            });
        }
    }

    function ItemSelectionchnage() {
        var itemselectionName = $('#drpItemSelection option:selected').text();
        var itemselectionNamearray = itemselectionName.split('-');
        var itemname = itemselectionNamearray[1];
        $('#d_ItemName').val(itemname);

    }

    function addZero()
    {
        var currentVepvalue = $('#d_CurrentPriceVEP').val();
        var newpriceVep = $('#d_NewPriceVEP').val();
            if (currentVepvalue != "")
        {
            $('#d_CurrentPriceVEP').val(Number(currentVepvalue).toFixed(2));
        }
        if (newpriceVep != "")
        {
                $('#d_NewPriceVEP').val(Number(newpriceVep).toFixed(2));
         }

    }

    function CalculateDiscount() {

        var currentVepvalue = $('#d_CurrentPriceVEP').val();
        var newpriceVep = $('#d_NewPriceVEP').val();
        var BranchId = $('#PVHeader_Branch').val();
        BranchId = BranchId.split('-')[1];
        if (newpriceVep > 0) {
            //if (Number(currentVepvalue) > Number(newpriceVep))
            //{
            //    $('#d_CurrentPriceVEP').val('');
            //    $('#d_NewPriceVEP').val('');
            //    $('#d_NewPriceVIP').val('')
            //    ShowMessage('Current VEP Price should be less New Price VEP');
            //    return false;
            //}
            //else
            if (BranchId == "") {
                $('#d_NewPriceVEP').val('');

                ShowMessage('Please Select the Branch');
                return false;
            }
            else {
                $('#d_Discount').val((currentVepvalue - newpriceVep).toFixed(2));
                var newprice = Number((newpriceVep * BranchId / 100) + Number(newpriceVep));
                $('#d_NewPriceVIP').val(newprice.toFixed(2))
            }
        }



        var discountcase = $('#d_Discount').val();
        if (discountcase != 0 && currentVepvalue != 0) {
            var discountper = (discountcase / currentVepvalue) * 100;
            $('#d_DiscountPer').val(discountper.toFixed(1))
        }

    }

    function CalculateDiscountChange(LineNO) {

        var currentVepvalue = $('#CurrentPriceVEP_' + LineNO).val();
        var newpriceVep = $('#NewPriceVEP_' + LineNO).val();
        var newpriceVip = $('#NewPriceVIP_' + LineNO).text();
        var BranchId = $('#PVHeader_Branch').val();
        BranchId = BranchId.split('-')[1];
        if (newpriceVep > 0) {
            if (BranchId == "") {
                $('#NewPriceVEP_' + LineNO).val('');

                ShowMessage('Please Select the Branch');
                return false;
            }
            else {
                $('#btnUpdateline_' + LineNO).css({ display: "block" });
                var value = Number(currentVepvalue - newpriceVep);
                $('#Discount_' + LineNO).text(value.toFixed(2));
                var newprice = Number((newpriceVep * BranchId / 100) + Number(newpriceVep));
                $('#NewPriceVIP_' + LineNO).text(newprice.toFixed(2))
            }
        }



        var discountcase = $('#Discount_' + LineNO).text();
        if (discountcase != 0 && currentVepvalue != 0) {
            $('#btnUpdateline_' + LineNO).css({ display: "block" });
            var discountper = (discountcase / currentVepvalue) * 100;
            $('#DiscountPer_' + LineNO).text(discountper.toFixed(1) + '%')
        }
    }

    function updatelineData(LineNO,actionby) {

        var startDate = document.getElementById("StartDate").value;
        var enddate = document.getElementById("EndDate").value;
        var entityId = $('#PVHeader_Entity').val();
        var BranchId = $('#PVHeader_Branch').val();
        BranchId = BranchId.split('-')[1];
        var pvcnumber = $('#Pvnumber').text();
        var currentPriceVEP = $('#CurrentPriceVEP_' + LineNO).val();
        var newPriceVEP = $('#NewPriceVEP_' + LineNO).val();
        var ExceptedVol = $('#ExpectedVolumn_' + LineNO).val();
        var itemselection = $('#ItemSelection_' + LineNO).text();

        if (startDate == '') {
            ShowMessage('Please Pick a "From Date"!');
            return false;
        }
        else if (enddate == '') {
            ShowMessage('Please Pick a "To Date"!');
            return false;
        }
        else if ((Date.parse(startDate) > Date.parse(enddate))) {
            ShowMessage('"To Date" should be greater than "From Date"!');
            return false;
        }
        else if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (BranchId == "") {
            ShowMessage('Please Select the Branch');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCSaveRequestChangeData?Itemselection=' + itemselection + '&CurrentVEPprice=' + currentPriceVEP + '&NewVEPprice=' + newPriceVEP + '&VatPerBranch=' + BranchId + '&ExpectedVol=' + ExceptedVol + '&PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&Startdate=' + startDate + '&Enddate=' + enddate + '&EDITONRELEASE=1',
                success: function (responsedata) {
                    debugger;
                    if (responsedata.success) {
                        $('#EndDate').prop('disabled', true);
                        $('#StartDate').prop('disabled', true);
                       
                        if (actionby == 0) {
                             $('#PvcLinetbl tbody').empty();
                        }
                        else if (actionby == 1) {
                             $('#PvcLinetbl tfoot').empty();
                        }
                        var jsondata = JSON.parse(responsedata.data);
                        debugger;
                        var SRNO = "";
                        $.each(jsondata, function (index, obj)
                        {

                            if (obj.NO == undefined) {
                                var SRNO = Number(index + 1);

                            }
                            else {
                                SRNO = obj.NO;
                            }

                            if (actionby == 0)
                            {
                                var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + SRNO + '</td><td>' + obj.ITEMTYPEDESC + '</td>';
                                newRow = newRow + '<td id="ItemSelection_' + SRNO + '" >' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "CurrentPriceVEP_' + SRNO + '" value=' + obj.CURRENTVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "NewPriceVEP_' + SRNO + '" value=' + obj.PROPOSEDVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td id="NewPriceVIP_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td id="Discount_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td id="DiscountPer_' + SRNO + '">' + obj.DISCPERCENTAGE.toFixed(1) + '<span> % </span></td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><input type="text"  class = "dontallow_decimal" style = "height: 17px;width:50px; font-size: 12px;" id= "ExpectedVolumn_' + SRNO + '"  onchange = "EnterVolumn(' + SRNO + ');" value=' + obj.EXPECTEDVOL + '></input ></td >';
                                newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + SRNO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + SRNO + ',0)">Update</button></td></tr>';
                                $('#PvcLinetbl tbody').append(newRow);
                            }
                            else if (actionby == 1)
                            {
                                debugger;
                                var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + SRNO + '</td><td>' + obj.ITEMTYPEDESC + '</td>';
                                newRow = newRow + '<td id="ItemSelection_' + SRNO + '" >' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "CurrentPriceVEP_' + SRNO + '" value=' + obj.CURRENTVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "NewPriceVEP_' + SRNO + '" value=' + obj.PROPOSEDVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td id="NewPriceVIP_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td id="Discount_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td id="DiscountPer_' + SRNO + '">' + obj.DISCPERCENTAGE.toFixed(1) + '<span> % </span></td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><input type="text"  class = "dontallow_decimal" style = "height: 17px;width:50px; font-size: 12px;" id= "ExpectedVolumn_' + SRNO + '"  onchange = "EnterVolumn(' + SRNO + ');" value=' + obj.EXPECTEDVOL + '></input ></td >';
                                newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + SRNO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + SRNO + ',1)">Update</button></td></tr>';
                                $('#PvcLinetbl tfoot').append(newRow);
                            }
                        });


                    }
                    else {
                        ShowMessage(responsedata.data);
                    }

                }
            });

        }




    }

    function EnterVolumn(LineNO) {
        $('#btnUpdateline_' + LineNO).css({ display: "block" });
    }

    function addZeroinlines(LineNO) {


        var currentVepvalue = $('#CurrentPriceVEP_' + LineNO).val();
        var newpriceVep = $('#NewPriceVEP_' + LineNO).val();
        if (currentVepvalue != "") {
            $('#CurrentPriceVEP_' + LineNO).val(Number(currentVepvalue).toFixed(2));
        }
        if (newpriceVep != "") {
            $('#NewPriceVEP_' + LineNO).val(Number(newpriceVep).toFixed(2));
        }

    }
    function CustomerApplicablechange() {
        var custType = $('#PVHeader_CustomerApplicable').val();
        var entityid = $('#PVHeader_Entity').val();
        if (custType != '') {
            $("#PVHeader_AccountSelection").empty();
            $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
            $.ajax({
                type: "GET",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/GetAccountSelection?CustType=' + custType + '&Entityid=' + entityid + '',
                success: function (responsedata) {

                    $("#PVHeader_AccountSelection").empty();
                    $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
                    $('#PVHeader_AccountSelection').attr('multiple', 'multiple');
                    var data = JSON.parse(responsedata);

                    $('#PVHeader_AccountSelection').append($("<option></option>").val('').html('Search'));
                    if (custType == "1") {
                        $.each(data, function (index, obj) {

                            $('#PVHeader_AccountSelection').append($("<option></option>").val(obj.SUBCHANNELID).html(obj.SUBCHANNELDESC));

                        });
                    }
                    else if (custType == "2") {
                        $.each(data, function (index, obj) {

                            $('#PVHeader_AccountSelection').append($("<option></option>").val(obj.CHAINID).html(obj.CHAINDESC));

                        });
                    }
                    else if (custType == "3") {
                        $.each(data, function (index, obj) {

                            $('#PVHeader_AccountSelection').append($("<option></option>").val(obj.CUSTPRICEGROUPID).html(obj.CUSTPRICEGROUPDESC));

                        });
                    }
                    else if (custType == "4") {
                        $('#PVHeader_AccountSelection').removeAttr('multiple');
                        $.each(data, function (index, obj) {

                            $('#PVHeader_AccountSelection').append($("<option></option>").val(obj.AccountNum).html(obj.CUSTOMERNAME));

                        });
                    }
                    $('#PVHeader_AccountSelection').chosen();

                }
            });
        }
    }

    function AddPvcItemline(actionby) {
        var startDate = document.getElementById("StartDate").value;
        var endDate = document.getElementById("EndDate").value;
        if (startDate == '') {
            ShowMessage('Please Pick a "From Date"!');
            return false;
        }
        else if (endDate == '') {
            ShowMessage('Please Pick a "To Date"!');
            return false;
        }

        else if ((Date.parse(startDate) > Date.parse(endDate))) {
            ShowMessage('"To Date" should be greater than "From Date"!');
            return false;
        }
        var itemtype = $('#d_ItemType option:selected').text()
        var itemtypeid = $('#d_ItemType').val();
        var ItemName = $('#drpItemSelection option:selected').text()
        var itemselection = $('#drpItemSelection').val();
        var currentVEPprice = $('#d_CurrentPriceVEP').val()
        var newVEPprice = $('#d_NewPriceVEP').val()
        var newvipprice = $('#d_NewPriceVIP').val()
        var discount = $('#d_Discount').val();
        var discountPer = $('#d_DiscountPer').val();
        var ExpectedVol = $('#d_ExpectedVolumn').val();
        var pvcnumber = $('#Pvnumber').text();
        var startDate = $('#StartDate').val();
        var enddate = $('#EndDate').val();
        var entityId = $('#PVHeader_Entity').val();
        var BranchId = $('#PVHeader_Branch').val();
        var status = actionby == "2" ? "6" : "0";
        BranchId = BranchId.split('-')[1];
        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (BranchId == "" || BranchId == undefined) {
            ShowMessage('Please Select the Branch');
            return false;
        }
        else if (startDate == "") {
            ShowMessage('Please Select the Start Date');
            return false;
        }
        else if (enddate == "") {
            ShowMessage('Please Select the End Date');
            return false;
        }
        //else if (pvcnumber == "") {
        //    ShowMessage('PV No is blank!Please refresh the window');
        //    return false;
        //}
        else if (itemtypeid == "") {
            ShowMessage('Please Select the Item Type');
            return false;
        }
        else if (itemselection == "") {
            ShowMessage('Please Select the Item');
            return false;
        }
        else if (currentVEPprice == "" || currentVEPprice <= 0) {
            ShowMessage('Please fill in the item details');
            return false;
        }
        else if (newVEPprice == "" || newVEPprice <= 0) {
            ShowMessage('Please Enter  the New VEP Price');
            return false;
        }
        else if (ExpectedVol == "" || ExpectedVol <= 0) {
            ShowMessage('Please Enter  the Expected Vol');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/AddPVCLineItem?VatPerBranch=' + BranchId + '&Itemtype=' + itemtypeid + '&Itemselection=' + itemselection + '&CurrentVEPprice=' + currentVEPprice + '&NewVEPprice=' + newVEPprice + '&ExpectedVol=' + ExpectedVol + '&PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&Startdate=' + startDate + '&Enddate=' + enddate + '&ItemName=' + ItemName + '&ItemTypeName=' + itemtype + '&Status='+status+'',
                success: function (responsedata) {

                    if (responsedata.success) {
                        $('#EndDate').prop('disabled', true);
                        $('#StartDate').prop('disabled', true);
                        var jsondata = JSON.parse(responsedata.data);
                        if (jsondata.length > 0)
                        {

                            if (jsondata[0].Failure === undefined)
                            {
                                $('#PvcLinetbl tfoot').empty();

                                if (actionby == 1)// BY Approver
                                {

                                    var removebutton = false;
                                    $.each(jsondata, function (index, obj) {

                                        var isapprove = false;
                                        var isreject = false;
                                        var checkbox = "";
                                        var statusbuttonApp = "";
                                        var statusbuttonreject = "";
                                        if (obj.ISAPPROVE == 0) {

                                            isapprove = true;
                                            statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                            statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                        }
                                        else if (obj.ISAPPROVE == 1) {
                                            isreject = true;
                                            statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                            statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                                        }
                                        else {
                                            isreject = false;
                                            isapprove = false;
                                            removebutton = true;
                                            statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                            statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                        }
                                        checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                                        var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.NO + '</td><td>' + obj.ITEMTYPEDESC + '</td><td>' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td><td><span class="for_AmountSign">$ </span>' + obj.CURRENTVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVEP.toFixed(2) + '</td>';
                                        newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td>' + obj.DISCPERCENTAGE + '<span> % </span></td><td>' + obj.EXPECTEDVOL + '</td>';
                                        newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';
                                        //newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';

                                        $('#PvcLinetbl tfoot').append(newRow);
                                        if (isapprove && isreject == false) {
                                            $("#btnRequestchnage").css({ display: "none" });
                                            $("#btnReject").css({ display: "none" });
                                            $("#btnApprove").css({ display: "block" });
                                        }
                                        else {
                                            $("#btnRequestchnage").css({ display: "none" });
                                            $("#btnApprove").css({ display: "none" });
                                        }
                                        if (isreject && isapprove == false) {
                                            $("#btnRequestchnage").css({ display: "block" });
                                            $("#btnReject").css({ display: "block" });
                                            $("#btnApprove").css({ display: "none" });
                                        }
                                        else {
                                            $("#btnRequestchnage").css({ display: "none" });
                                            $("#btnReject").css({ display: "none" });
                                        }

                                        if (isreject)
                                        {

                                            $("#btnRequestchnage").css({ display: "block" });
                                        }
                                        else {
                                            $("#btnRequestchnage").css({ display: "none" });
                                        }

                                        if (removebutton)
                                        {
                                            $("#btnReject").css({ display: "none" });
                                            $("#btnApprove").css({ display: "none" });
                                        }
                                    });
                                }
                                else if (actionby == 2)// BY Approver
                                {

                                    
                                    $.each(jsondata, function (index, obj) {

                                       
                                        var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + obj.NO  + '</td><td>' + obj.ITEMTYPEDESC + '</td>';
                                        newRow = newRow + '<td id="ItemSelection_' + obj.NO  + '" >' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td>';
                                        newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + obj.NO + ');CalculateDiscountChange(' + obj.NO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "CurrentPriceVEP_' + obj.NO  + '" value=' + obj.CURRENTVEP.toFixed(2) + '></input ></td >';
                                        newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + obj.NO + ');CalculateDiscountChange(' + obj.NO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "NewPriceVEP_' + obj.NO  + '" value=' + obj.PROPOSEDVEP.toFixed(2) + '></input ></td >';
                                        newRow = newRow + '<td id="NewPriceVIP_' + obj.NO + '"><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td id="Discount_' + obj.NO + '"><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td id="DiscountPer_' + obj.NO  + '">' + obj.DISCPERCENTAGE.toFixed(1) + '<span> % </span></td>';
                                        newRow = newRow + '<td><span class="mobile-before-label"></span><input type="text"  class = "dontallow_decimal" style = "height: 17px;width:50px; font-size: 12px;" id= "ExpectedVolumn_' + obj.NO + '" onchange = "EnterVolumn(' + obj.NO  + ');" value=' + obj.EXPECTEDVOL + '></input ></td >';
                                        newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + obj.NO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + obj.NO + ',1)">Update</button></td><td></td><td></td></tr>';
                                        $('#PvcLinetbl tfoot').append(newRow);

                                       
                                        
                                    });
                                }
                            } else { ShowMessage(jsondata[0].Failure); }
                        }

                        ResetAddLine();
                    }
                    else {
                        ShowMessage(responsedata.data);
                    }

                }
            });
        }




    }

    function ResetAddLine() {
        $('#d_ItemType').get(0).selectedIndex = -1;
        $('#drpItemSelection').get(0).selectedIndex = -1;
        $('#drpItemSelection').empty();
        $("#drpItemSelection").chosen("destroy").chosen();
        $("#d_ItemType").chosen("destroy").chosen();
        $('#d_ItemName').val('');
        $('#d_CurrentPriceVEP').val('')
        $('#d_NewPriceVEP').val('')
        $('#d_NewPriceVIP').val('')
        $('#d_Discount').val('');
        $('#d_DiscountPer').val('');
        $('#d_ExpectedVolumn').val('');
    }

    function RemovePVLine(actionby) {

        var itemCode = $("#PvcLinetbl tfoot tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(4)").text();
            return ItemCode;
        }).toArray();
        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();
        var actionstatus = actionby == "2" ? "6" : "0";
        if (itemCode.length <= 0) {
            ShowMessage("Please select the line to Remove");
            return false;
        }


        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        //else if (pvcnumber == "") {
        //    ShowMessage('PV No is blank!Please refresh the window');
        //    return false;
        //}
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/DeletePVLineItem?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&SelectedItem=' + itemCode + '&Actionstatus=' + actionstatus + '',
                success: function (responsedata) {

                    if (responsedata.success) {
                        $('#chkBoxSelectAll').attr('checked', false);
                        $('#PvcLinetbl tfoot').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var RowCount = $("#PvcLinetbl > tfoot").find("tr").length;
                        if (RowCount == 0) {
                            $('#EndDate').prop('disabled', false);
                            $('#StartDate').prop('disabled', false);
                        }
                        if (actionby == 1)// BY Approver
                        {
                            var removebutton = false;
                            $.each(jsondata, function (index, obj) {


                                var isapprove = false;
                                var isreject = false;
                                var checkbox = "";
                                var statusbuttonApp = "";
                                var statusbuttonreject = "";
                                if (obj.ISAPPROVE == 0) {

                                    isapprove = true;
                                    statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                    statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                }
                                else if (obj.ISAPPROVE == 1) {
                                    isreject = true;
                                    statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                    statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                                }
                                else {
                                    isreject = false;
                                    isapprove = false;
                                    statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                    statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>'; removebutton = true;
                                }
                                checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                                var newRow = '<tr><td>' + checkbox + '</td><td>' + Number(index + 1) + '</td><td>' + obj.ITEMTYPEDESC + '</td><td>' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td><td><span class="for_AmountSign">$ </span>' + obj.CURRENTVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVEP.toFixed(2) + '</td>';
                                newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td>' + obj.DISCPERCENTAGE + '<span> % </span></td><td>' + obj.EXPECTEDVOL + '</td>';
                                newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';
                                //newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';

                                $('#PvcLinetbl tfoot').append(newRow);

                                if (isapprove && isreject == false) {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                    $("#btnApprove").css({ display: "block" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                if (isreject && isapprove == false) {
                                    $("#btnRequestchnage").css({ display: "block" });
                                    $("#btnReject").css({ display: "block" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                }

                                if (isreject) {

                                    $("#btnRequestchnage").css({ display: "block" });
                                } else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                }

                            });
                            if (removebutton) {
                                $("#btnReject").css({ display: "none" });
                                $("#btnApprove").css({ display: "none" });
                            }
                        }
                        else if (actionby == 2)// BY Approver
                        {

                            $.each(jsondata, function (index, obj)
                            {
                                if (obj.NO == undefined)
                                {
                                    var SRNO = Number(index + 1);

                                }
                                else {
                                    SRNO = obj.NO;
                                }
                                var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + SRNO + '</td><td>' + obj.ITEMTYPEDESC + '</td>';
                                newRow = newRow + '<td id="ItemSelection_' + SRNO + '" >' + obj.ITEMTYPECODE + '</td><td>' + obj.ITEMNAME + '</td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "CurrentPriceVEP_' + SRNO + '" value=' + obj.CURRENTVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><span class="for_AmountSign">$ </span><input type="text" onchange = "addZeroinlines(' + SRNO + ');CalculateDiscountChange(' + SRNO + ')" class = "allow_numeric" style = "height: 17px;width:44px; font-size: 12px;" id= "NewPriceVEP_' + SRNO + '" value=' + obj.PROPOSEDVEP.toFixed(2) + '></input ></td >';
                                newRow = newRow + '<td id="NewPriceVIP_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.PROPOSEDVIP.toFixed(2) + '</td><td id="Discount_' + SRNO + '"><span class="for_AmountSign">$ </span>' + obj.DISCPERCASE.toFixed(2) + '</td><td id="DiscountPer_' + SRNO + '">' + obj.DISCPERCENTAGE.toFixed(1) + '<span> % </span></td>';
                                newRow = newRow + '<td><span class="mobile-before-label"></span><input type="text"  class = "dontallow_decimal" style = "height: 17px;width:50px; font-size: 12px;" id= "ExpectedVolumn_' + SRNO + '" onchange = "EnterVolumn(' + SRNO + ');" value=' + obj.EXPECTEDVOL + '></input ></td >';
                                newRow = newRow + '<td><button class="btn-btnPopup" id="btnUpdateline_' + SRNO + '" type="button"  style = "width:77px;display:none" accesskey="A" onclick="updatelineData(' + SRNO + ',1)">Update</button></td><td></td><td></td></tr>';
                                $('#PvcLinetbl tfoot').append(newRow);
                            });
                                }


                    }
                    else {
                        ShowMessage(jsondata.data);
                    }

                }
            });

        }
    }

    function UpdatePVCDataApproval() {

        var startDate = document.getElementById("StartDate").value;
        var endDate = document.getElementById("EndDate").value;

        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();
        var BranchId = $('#PVHeader_Branch').val();
        BranchId = BranchId.split('-')[0];
        var Pricetier = $('#PVHeader_PriceTier').val();
        var CustApplicable = $('#PVHeader_CustomerApplicable').val();
        var Desctiption = $('#PVHeader_Description').val();
        var AccountSelection = $('#PVHeader_AccountSelection').val();
        var AccountSelectiondesc = $('#PVHeader_AccountSelection option:selected').toArray().map(item => item.text);


        if (startDate == '') {
            ShowMessage('Please Pick a "From Date"!');
            return false;
        }
        else if (endDate == '') {
            ShowMessage('Please Pick a "To Date"!');
            return false;
        }

        else if ((Date.parse(startDate) > Date.parse(endDate))) {
            ShowMessage('"To Date" should be greater than "From Date"!');
            return false;
        }
        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (BranchId == "") {
            ShowMessage('Please Select the Branch');
            return false;
        }
        else if (CustApplicable == "") {
            ShowMessage('Please Select the Customer Applicable');
            return false;
        }
        else if (AccountSelection == ""||AccountSelection ==null) {
            ShowMessage('Please Select the Account Selection');
            return false;
        }
        else if (Pricetier == "") {
            ShowMessage('Please select the Price Tier');
            return false;
        }
        else if (Desctiption == "") {
            ShowMessage('Please Enter  the Description');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCUpdateHeaderData?StartDate=' + startDate + '&EndDate=' + endDate + '&PVCNO=' + pvcnumber + '&BranchId=' + BranchId + '&PriceTier=' + Pricetier + '&AccountSelection=' + AccountSelection + '&Desctiption=' + encodeURIComponent(Desctiption) + '&CustApplicable=' + CustApplicable + '&Entityid=' + entityId + '&AccountSelectionDesc=' + AccountSelectiondesc + '',
                success: function (responsedata) {
                    if (responsedata.success) {
                        $('#btnUpdatePVC').css({ display: "none" });
                        $('#btnReleaseMSD').css({ display: "block" });
                        $('#btnUpdateReleaseMSD').css({ display: "block" });

                        $('#btnCreateNewGroup').css({ display: "none" });
                        $('#btnRenameGroup').css({ display: "none" });
                        $('#accFileUpload').css({ display: "none" });
                        $('#accuploadfile').css({ display: "none" });
                        $('#accdownloadtemp').css({ display: "none" });
                        $('#btnAccountAdd').css({ display: "none" });
                        $('#btnAccountRemove').css({ display: "none" });
                        $('#hdnNewGroup').val(0)

                        $('#PVHeader_Entity').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_Branch').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_PriceTier').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_CustomerApplicable').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_Entity').attr('disabled', true);
                        $('#PVHeader_Branch').attr('disabled', true);
                        $('#PVHeader_PriceTier').attr('disabled', true);
                        $('#PVHeader_CustomerApplicable').attr('disabled', true);
                        $('#StartDate').attr('disabled', true);
                        $('#EndDate').attr('disabled', true);
                        $('#PVHeader_Description').attr('disabled', true);
                        $('#PVHeader_AccountSelection').attr('disabled', true);
                        $('#PVHeader_AccountSelection').chosen();
                        ShowMessage(pvcnumber +" has been Updated");
                    }
                    else {
                        ShowMessage(responsedata.responseText);
                    }

                }
            });
        }
    }

    function Unabledisabledfield() {

        $('#EndDate').prop('disabled', false);
        $('#StartDate').prop('disabled', false);
        $('#btnUpdatePVC').css({ display: "block" });
        $('#btnRenameGroup').css({ display: "block" });
        $('#btnRenameItemGroup').css({ display: "block" });
        $('#btnEditpvc').css({ display: "none" });
        $('#btnReleaseMSD').css({ display: "none" });
        $('#btnUpdateReleaseMSD').css({ display: "none" });
        $('#btnCreateNewGroup').css({ display: "block" });
        $('#btnAccountAdd').css({ display: "block" });
        $('#btnAccountRemove').css({ display: "block" });
        $('#hdnNewGroup').val(1)
        $('#PVHeader_Entity').attr('enabled', 'false').chosen("destroy");
        $('#PVHeader_Branch').attr('enabled', 'false').chosen("destroy");
        $('#PVHeader_PriceTier').attr('enabled', 'false').chosen("destroy");
        $('#PVHeader_CustomerApplicable').attr('enabled', 'false').chosen("destroy");
        $('#PVHeader_AccountSelection').attr('enabled', 'false').chosen("destroy");
        $('#PVHeader_AccountSelection').attr('disabled', false);
        $('#PVHeader_AccountSelection').chosen();

        $('#PVHeader_Entity').attr('disabled', false);
        $('#PVHeader_Branch').attr('disabled', false);
        $('#PVHeader_PriceTier').attr('disabled', false);
        $('#PVHeader_CustomerApplicable').attr('disabled', false);
        $('#PVHeader_Description').attr('disabled', false);
        $('#PVHeader_Entity').chosen();
        $('#PVHeader_Branch').chosen();
        $('#PVHeader_PriceTier').chosen();
        $('#PVHeader_CustomerApplicable').chosen();
        $('#PVHeader_AccountSelection').chosen();


    }

    function UpdatePVCDataRelease() {

        var startDate = document.getElementById("StartDate").value;
        var endDate = document.getElementById("EndDate").value;

        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();
        var BranchId = $('#PVHeader_Branch').val();
        BranchId = BranchId.split('-')[0];
        var Pricetier = $('#PVHeader_PriceTier').val();
        var CustApplicable = $('#PVHeader_CustomerApplicable').val();
        var Desctiption = $('#PVHeader_Description').val();
        var AccountSelection = $('#PVHeader_AccountSelection').val();
        var AccountSelectiondesc = $('#PVHeader_AccountSelection option:selected').toArray().map(item => item.text);
        //var RowCount = $("#PvcLinetbl > tfoot").find("tr").length;
        //if (RowCount == 0) {
        //    ShowMessage('Please Add the Line Details');
        //    return false;
        //}

        if (startDate == '') {
            ShowMessage('Please Pick a "From Date"!');
            return false;
        }
        else if (endDate == '') {
            ShowMessage('Please Pick a "To Date"!');
            return false;
        }

        else if ((Date.parse(startDate) > Date.parse(endDate))) {
            ShowMessage('"To Date" should be greater than "From Date"!');
            return false;
        }
        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (BranchId == "") {
            ShowMessage('Please Select the Branch');
            return false;
        }
        else if (CustApplicable == "") {
            ShowMessage('Please Select the Customer Applicable');
            return false;
        }
        else if(AccountSelection == "" || AccountSelection == null){
            ShowMessage('Please Select the Account Selection');
            return false;
        }
        else if (Pricetier == "") {
            ShowMessage('Please select the Price Tier');
            return false;
        }
        else if (Desctiption == "") {
            ShowMessage('Please Enter  the Description');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCUpdateHeaderData?StartDate=' + startDate + '&EndDate=' + endDate + '&PVCNO=' + pvcnumber + '&BranchId=' + BranchId + '&PriceTier=' + Pricetier + '&AccountSelection=' + AccountSelection + '&Desctiption=' + encodeURIComponent(Desctiption) + '&CustApplicable=' + CustApplicable + '&Entityid=' + entityId + '&AccountSelectionDesc=' + AccountSelectiondesc + '&updatetype=1',
                success: function (responsedata) {
                    if (responsedata.success) {

                        $('#btnUpdatePVC').css({ display: "none" });
                        $('#btnReleaseMSD').css({ display: "block" });
                        $('#btnUpdateReleaseMSD').css({ display: "block" });
                        $('#btnEditpvc').css({ display: "block" });
                        $('#btnCreateNewGroup').css({ display: "none" });
                        $('#btnRenameGroup').css({ display: "none" });
                        $('#btnRenameItemGroup').css({ display: "none" });
                        $('#accFileUpload').css({ display: "none" });
                        $('#accuploadfile').css({ display: "none" });
                        $('#accdownloadtemp').css({ display: "none" });
                        $('#btnAccountAdd').css({ display: "none" });
                        $('#btnAccountRemove').css({ display: "none" });
                        $('#hdnNewGroup').val(0)

                        $('#PVHeader_Entity').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_Branch').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_PriceTier').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_CustomerApplicable').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_AccountSelection').attr('enabled', 'true').chosen("destroy");
                        $('#PVHeader_Entity').attr('disabled', true);
                        $('#PVHeader_Branch').attr('disabled', true);
                        $('#PVHeader_PriceTier').attr('disabled', true);
                        $('#PVHeader_CustomerApplicable').attr('disabled', true);
                        $('#StartDate').attr('disabled', true);
                        $('#EndDate').attr('disabled', true);
                        $('#PVHeader_Description').attr('disabled', true);
                        $('#PVHeader_AccountSelection').attr('disabled', true);
                        $('#PVHeader_AccountSelection').chosen();
                        ShowMessage(pvcnumber + " has been Updated");
                    }
                    else {
                        ShowMessage(responsedata.responseText);
                    }

                }
            });
        }
    }

    function Validate() {
        var startDate = document.getElementById("StartDate").value;
        var endDate = document.getElementById("EndDate").value;
        if (startDate == '') {
            ShowMessage('Please Pick a "From Date"!');
            return false;
        }
        else if (endDate == '') {
            ShowMessage('Please Pick a "To Date"!');
            return false;
        }

        else if ((Date.parse(startDate) > Date.parse(endDate))) {
            ShowMessage('"To Date" should be greater than "From Date"!');
            return false;
        }
        else {
            return true;
        }
    }

    function validatefile() {

        var fileName = $('#FileUpload')[0].files[0];
        var pvcnumber = $('#Pvnumber').text();
        var entityid = '@Model.PVHeader.ENTITYID.ToString()'
        var data = new FormData();
        if (document.getElementById("FileUpload").files.length == 0) {
            ShowMessage("Please select the file first");
            return false;
        }
        if (fileName != undefined) {
            var size = parseFloat(fileName.size / 1024).toFixed(2);
            if (size > 5120) {
                ShowMessage("File size must not exceed 5 MB.... !!")
                return false;
            }
        }
        if (pvcnumber == "") {
            ShowMessage('Please save the form to upload');//('PV No is blank!Please Saved the data First');
            return false;
        }
        else {

            if (document.getElementById("FileUpload").files.length > 0) {
                data.append("PVFile", $('#FileUpload')[0].files[0]);
                data.append("PVNumseq", pvcnumber);
                data.append("Entityid", entityid);
                $.ajax({
                    url: '/PriceVariance/UploadPVfiles',
                    type: 'POST',
                    data: data,
                    contentType: false,
                    processData: false,
                    success: function (responsedata) {

                        if (responsedata.success) {

                            var row = "";

                            if (responsedata.exttype.toUpperCase() == ".PDF") {
                                row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + responsedata.imagename + '"><a class="img-show" href="' + responsedata.responseText + '" value="' + responsedata.responseText + '" target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/pdf image.jpg" ></a>'

                            }
                            else if (responsedata.exttype.toUpperCase() == ".DOCX") {
                                row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + responsedata.imagename + '"><a class="img-show" href="' + responsedata.responseText + '" value="' + responsedata.responseText + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/word.jpg" ></a>'

                            }
                            else if (responsedata.exttype.toUpperCase() == ".XLSX") {
                                row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + responsedata.imagename + '"><a class="img-show" href="' + responsedata.responseText + '" value="' + responsedata.responseText + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/Excel image.jpg" ></a>'

                            }

                            else if (responsedata.exttype.toUpperCase() == ".JPG" || responsedata.exttype.toUpperCase() == ".JPEG" || responsedata.exttype.toUpperCase() == ".PNG") {
                                row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + responsedata.imagename + '"><a class="img-show" href="' + responsedata.responseText + '" value="' + responsedata.responseText + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/jpg-image.jpg" ></a>'

                            }

                            $('#divImgUpload').append(row);
                            $('#fileplaceholder').text('No file Chosen');
                            $('#FileUpload').val('');
                            ShowMessage("File upload successful");
                        }
                        else {
                            ShowMessage(responsedata.responseText);
                        }

                    }
                });
            } else {
                ShowMessage("Plesae select the file to upload!");
                return false;
            }

        }
    }


    function UpdateLineStatusApproval(UpdateType, ItemCode) {
        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();

        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCApproverLineAction?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&ActionType=' + UpdateType + '&ItemCode=' + ItemCode + '',
                success: function (responsedata) {
                    debugger;
                    if (responsedata.success) {
                        $('#chkBoxSelectAll').attr('checked', false);
                        $('#PvcLinetbl tfoot').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var isapprove = false;
                        var isreject = false;
                        var statusbutton = "";
                        $.each(jsondata, function (index, obj) {
                            var checkbox = "";
                            var statusbuttonApp = "";
                            var statusbuttonreject = "";
                            if (obj.ISAPPROVE == 0) {

                                isapprove = true;
                                statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                            }
                            else if (obj.ISAPPROVE == 1) {
                                isreject = true;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            else {
                                isreject = false;
                                isapprove = false;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                            var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                            newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                            newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';
                            $('#PvcLinetbl tfoot').append(newRow);

                            if (isapprove && isreject == false)
                            {
                                $("#btnRequestchnage").css({ display: "none" });
                                $("#btnReject").css({ display: "none" });
                                $("#btnApprove").css({ display: "block" });
                            }
                            else
                            {
                                $("#btnRequestchnage").css({ display: "none" });
                                $("#btnApprove").css({ display: "none" });
                            }
                            if (isreject && isapprove == false)
                            {
                                $("#btnRequestchnage").css({ display: "block" });
                                $("#btnReject").css({ display: "block" });
                                $("#btnApprove").css({ display: "none" });
                            }
                            else
                            {
                                $("#btnRequestchnage").css({ display: "none" });
                                $("#btnReject").css({ display: "none" });
                            }

                            if (isreject)
                            {
                                $("#btnRequestchnage").css({ display: "block" });
                            }
                            else {
                                $("#btnRequestchnage").css({ display: "none" });
                            }

                        });
                    }
                    else {
                        ShowMessage(jsondata.data);
                    }

                }
            });

        }
    }

    function UpdateLineStatus(UpdateType, ItemCode, entityId)
    {
        var pvcnumber = $('#Pvnumber').text();

        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCApproverLineAction?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&ActionType=' + UpdateType + '&ItemCode=' + ItemCode + '',
                success: function (responsedata) {

                    if (responsedata.success) {
                        $('#chkBoxSelectAll').attr('checked', false);
                        $('#PvcLinetbl tbody').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var isapprove = false;
                        var isreject = false;
                        $.each(jsondata, function (index, obj) {
                            debugger;
                            var checkbox = "";
                            var statusbutton = "";
                            var statusbuttonApp = "";
                            var statusbuttonreject = "";
                            if (UpdateType == 4 || UpdateType == 5)
                            {
                                var statusapp = 4;
                                var statusreject = 5;
                            }
                            if (UpdateType == 6 || UpdateType == 7) {
                                var statusapp = 6;
                                var statusreject = 7;
                            }

                            if (obj.ISAPPROVE == 0)
                            {

                                isapprove = true;
                                statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatus(\'' + statusapp + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatus(\'' + statusreject + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';
                            }
                            else if (obj.ISAPPROVE == 1) {
                                isreject = true;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatus(\'' + statusapp +'\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatus(\'' + statusreject +'\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            else {
                                isreject = false;
                                isapprove = false;

                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatus(\'' + statusapp + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatus(\'' + statusreject + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                            var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                            newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                            newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';
                            $('#PvcLinetbl tbody').append(newRow);

                            if (isapprove && isreject == false)
                            {
                                $("#btnRequestchnage").css({ display: "none" });
                                $("#btnReject").css({ display: "none" });
                                $("#btnApprove").css({ display: "block" });
                                $("#btnEscalate").css({ display: "block" });
                            }
                            else
                            {
                                $("#btnApprove").css({ display: "none" });
                                $("#btnEscalate").css({ display: "none" });
                                $("#btnRequestchnage").css({ display: "block" });
                            }

                            if (isreject && isapprove == false)
                            {
                                $("#btnReject").css({ display: "block" });
                                $("#btnApprove").css({ display: "none" });
                                $("#btnRequestchnage").css({ display: "block" });
                                $("#btnEscalate").css({ display: "none" });
                            }
                            else
                            {
                                $("#btnReject").css({ display: "none" });
                                $("#btnRequestchnage").css({ display: "none" });

                            }
                            if (isreject)
                            {
                                $("#btnRequestchnage").css({ display: "block" });
                                $("#btnEscalate").css({ display: "none" });
                            }
                            else {
                                $("#btnRequestchnage").css({ display: "none" });
                            }
                        });
                    }
                    else {
                        ShowMessage(jsondata.data);
                    }

                }
            });

        }
    }


    function UpdateAllLineStatus(UpdateType, entityId) {

        var itemCode = $("#PvcLinetbl tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(4)").text();
            return ItemCode;
        }).toArray();
        var pvcnumber = $('#Pvnumber').text();
        if (itemCode.length <= 0)
        {
            if (UpdateType == 4 || UpdateType == 6) {
                ShowMessage("Please select the lines to Approve");//("Please Select the Line")}
            }
            else if (UpdateType == 5 || UpdateType == 7) {
                ShowMessage("Please select the lines to Reject");//("Please Select the Line");}
            }
            return false;
        }

        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCApproverLineAction?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&ActionType=' + UpdateType + '&ItemCode=' + itemCode + '',
                success: function (responsedata) {

                    if (responsedata.success) {
                        debugger;
                        $('#chkBoxSelectAll').attr('checked', false);
                        $('#PvcLinetbl tbody').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var isapprove = false;
                        var isreject = false;
                        $.each(jsondata, function (index, obj)
                        {
                            debugger;
                            var ImgApprove = "";
                            var ImgReject = "";
                            var checkbox = "";
                            var statusbutton = "";
                            var statusbuttonApp = "";
                            var statusbuttonreject = "";
                            if (UpdateType == 4 || UpdateType == 5)
                            {
                                var statusapp = 4;
                                var statusreject = 5;
                            }
                            if (UpdateType == 6 || UpdateType == 7)
                            {
                                var statusapp = 6;
                                var statusreject = 7;
                            }
                            if (obj.ISAPPROVE == 0)
                            {

                                isapprove = true;
                                statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatus(\'' + statusapp + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatus(\'' + statusreject + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';
                            }
                            else if (obj.ISAPPROVE == 1) {
                                isreject = true;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatus(\'' + statusapp + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatus(\'' + statusreject + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            else {
                                isreject = false;
                                isapprove = false;

                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatus(\'' + statusapp + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatus(\'' + statusreject + '\',\'' + obj.ItemSelection + '\',\'' + obj.DATAAREAID + '\')" type="button" id="btnstatusline">REJECT</button>';


                            }

                            checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';

                            var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                            newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                            newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';

                            $('#PvcLinetbl tbody').append(newRow);
                            if (isapprove && isreject == false)
                            {
                                $("#btnReject").css({ display: "none" });
                                $("#btnApprove").css({ display: "block" });
                                $("#btnEscalate").css({ display: "block" });
                            }
                            else
                            {
                                $("#btnApprove").css({ display: "none" });
                                $("#btnEscalate").css({ display: "none" });
                            }
                            if (isreject && isapprove == false)
                            {
                                $("#btnReject").css({ display: "block" });
                                $("#btnApprove").css({ display: "none" });
                                $("#btnEscalate").css({ display: "none" });

                            }
                            else
                            {
                                $("#btnReject").css({ display: "none" });

                            }
                            if (isreject) {
                                $("#btnRequestchnage").css({ display: "block" });
                                $("#btnEscalate").css({ display: "none" });
                            }
                            else
                            {
                                $("#btnRequestchnage").css({ display: "none" });
                            }
                        });
                    }
                    else {
                        ShowMessage(jsondata.data);
                    }

                }
            });

        }
    }

    function UpdateAllLineStatusApproval(UpdateType) {

        var itemCode = $("#PvcLinetbl tfoot tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(4)").text();
            return ItemCode;
        }).toArray();
        var pvcnumber = $('#Pvnumber').text();
        var entityId = $('#PVHeader_Entity').val();
        if (itemCode.length <= 0)
        {
            if (UpdateType == 2)
            {
                ShowMessage("Please select the lines to Approve");//("Please Select the Line");

            }
            else if (UpdateType == 3) {
                ShowMessage("Please select the lines to Reject");//("Please Select the Line");

            }

            return false;
        }

        if (entityId == "") {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCApproverLineAction?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&ActionType=' + UpdateType + '&ItemCode=' + itemCode + '',
                success: function (responsedata) {

                    if (responsedata.success) {
                        $('#chkBoxSelectAll').attr('checked', false);
                        $('#PvcLinetbl tfoot').empty();
                        var jsondata = JSON.parse(responsedata.data);
                        var isapprove = false;
                        var isreject = false;
                        $.each(jsondata, function (index, obj) {
                            var ImgApprove = "";
                            var ImgReject = "";
                            var checkbox = "";
                            var statusbuttonApp = "";
                            var statusbuttonreject = "";
                            if (obj.ISAPPROVE == 0) {

                                isapprove = true;
                                statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                            }
                            else if (obj.ISAPPROVE == 1) {
                                isreject = true;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            else {
                                isreject = false;
                                isapprove = false;
                                statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                            }
                            checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';

                            var newRow = '<tr><td>' + checkbox + '</td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                            newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                            newRow = newRow + '<td style="text-align: center;">' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td></tr>';
                            //newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';

                            $('#PvcLinetbl tfoot').append(newRow);
                            if (isapprove && isreject == false) {
                                $("#btnReject").css({ display: "none" });
                                $("#btnApprove").css({ display: "block" });
                            }
                            else { $("#btnApprove").css({ display: "none" }); }
                            if (isreject && isapprove == false) {
                                $("#btnReject").css({ display: "block" });
                                $("#btnApprove").css({ display: "none" });
                            }
                            else { $("#btnReject").css({ display: "none" }); }

                            if (isreject)
                            { $("#btnRequestchnage").css({ display: "block" }); }
                            else {
                                $("#btnRequestchnage").css({ display: "none" });
                            }
                        });
                    }
                    else {
                        ShowMessage(responsedata.data);
                    }

                }
            });

        }
    }

    function UpdateHeaderStatus(UpdateType, status, entityId) {

        var RowCount = $("#PvcLinetbl > tfoot").find("tr").length;
        var pvcnumber = $('#Pvnumber').text();

        var approvercmmt = "";
        if (UpdateType == "0" && status == "1")
        {
            approvercmmt = $('#PVHeader_firstApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }

        }
        if (UpdateType == "0" && status == "2") {
            approvercmmt = $('#PVHeader_secondApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }

        }
        if (UpdateType == "0" && status == "3") {
            approvercmmt = $('#PVHeader_thirdApprovercomment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }

        }
        if (UpdateType == "3" && status == "0") {
            approvercmmt = $('#PVHeader_secondApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        if (UpdateType == "1" && status == "2") {

            approvercmmt = $('#PVHeader_firstApproverComment').val();
            var countimg = $('#divImgUpload').find('img').length;
            if (RowCount == 0)
            {
                ShowMessage('Please Add the Line Details');
                return false;
            }
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
            if (countimg == 0) {
                ShowMessage('Please Upload  the Attachment');
                return false;
            }
        }
        else if (UpdateType == "1" && status == "4")
        {

            approvercmmt = $('#PVHeader_secondApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        else if (UpdateType == "1" && status == "6")
        {
            approvercmmt = $('#PVHeader_thirdApprovercomment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        else if (UpdateType == "2" && status == "3")
        {
            if (RowCount == 0)
            {
                ShowMessage('Please Add the Line Details');
                return false;
            }
            approvercmmt = $('#PVHeader_firstApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        else if (UpdateType == "2" && status == "5") {
            approvercmmt = $('#PVHeader_secondApproverComment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        else if (UpdateType == "2" && status == "7") {
            approvercmmt = $('#PVHeader_thirdApprovercomment').val();
            if (approvercmmt == "") {
                ShowMessage("Approver comment is mandatory");
                return false;
            }
        }
        if (entityId == "")
        {
            ShowMessage('Please Select the Entity');
            return false;
        }
        else if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCApproverHeaderAction?PVCNUM=' + pvcnumber + '&Entityid=' + entityId + '&ActionType=' + UpdateType + '&Status=' + status + '&Approvercmmt=' + encodeURIComponent(approvercmmt) + '',
                success: function (responsedata) {

                    if (responsedata.success)
                    {
                        var homeurl = '/Home/Dashboard';
                        var jsondata = JSON.parse(responsedata.data);
                     if (UpdateType == '3') {
                        ShowMessage(pvcnumber + " has been Escalated to Approver 3")
                        setInterval(
                            function () {
                                window.location.href = homeurl;
                            },
                            2000
                        );
                    }
                    else if (UpdateType == '0') {
                        ShowMessage("You have requested for a change in " + pvcnumber);
                        setInterval(
                            function () {
                                window.location.href = homeurl;
                            },
                            2000
                        );

                    }
                        else if (status == '2')
                        {
                            ShowMessage(pvcnumber +" has been Approved")
                            setInterval(
                                function () {
                                    window.location.href = homeurl;
                                },
                                2000
                            );;

                        }
                        else if (status == '4')
                        {
                            ShowMessage(pvcnumber +" has been Approved")
                            setInterval(
                                function () {
                                    window.location.href = homeurl;
                                },
                                2000
                            );;

                        }
                        else if (status == '6')
                        {
                            ShowMessage(pvcnumber +" has been Approved")
                            setInterval(
                                function () {
                                   window.location.href = homeurl;
                                },
                                2000
                            );

                        }
                        else if (status == '3') {
                            ShowMessage(pvcnumber +" has been Rejected")
                            setInterval(
                                function () {
                                    window.location.href = homeurl;
                                },
                                2000
                            );

                        }
                        else if (status == '5')
                        {
                            ShowMessage(pvcnumber +" has been Rejected")
                            setInterval(
                                function () {
                                    window.location.href = homeurl;
                                },
                                2000
                            );

                        }
                        else if (status == '7') {
                            ShowMessage(pvcnumber +" has been Rejected")
                            setInterval(
                                function () {
                                     window.location.href = homeurl;
                                },
                                2000
                            );

                        }

                    }
                    else {
                        ShowMessage(responsedata.data);
                    }

                }
            });

        }
    }

    function ViewImage()
    {

    }

    function ReleaseData(actiontype) {
        var pvcnumber = $('#Pvnumber').text();
        if (pvcnumber == "")
        {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else
        {
            if (actiontype == 1)
            {
                if (!Accountselectionsycn)
                {
                    ShowMessage('Please sync account Selection');
                    return false;
                }
                if (!Itemselectionsycn) {
                    ShowMessage('Please sync Item Selection');
                    return false;
                }
            }

            $('.loader_overlay, #loading').show();
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/PVCSendReleaseData?PVCNUM=' + pvcnumber + '&Actiontype=' + actiontype + '',
                success: function (responsedata) {
                    $('#loading').hide();
                    $('.loader_overlay').fadeOut();
                    if (responsedata.success) {

                        ShowMessage(responsedata.responseText);
                        setInterval(
                            function () {
                                var url = '/PriceVariance/PVFormHistory';
                                window.location.href = url;
                            },
                            2000
                        );



                    }
                    else {
                        ShowMessage(responsedata.responseText);
                    }

                },
                complete: function () {
                    $('#loading').hide();
                    $('.loader_overlay').fadeOut();
                }
            });

        }
    }

    function Imagedelete(PVCNO) {

        var selectedarray = [];
        $('#divImgUpload input:checked').each(function () {
            selectedarray.push($(this).attr('id'));
        });
        if (selectedarray.length == 0) {
            ShowMessage("please select the checkbox to delete the file");
            return false;
        }

        $.ajax({
            type: "POST",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/UploadImagedelete?PVCNUM=' + PVCNO + '&ImageUrl=' + selectedarray + '',
            success: function (responsedata) {
                $('#loading').hide();
                $('.loader_overlay').fadeOut();
                if (responsedata.success) {
                    $('#divImgUpload').empty();
                    var data = JSON.parse(responsedata.data);
                    ShowMessage("File has been Removed");
                    $.each(data, function (index, obj) {
                        var row = "";

                        var exttype = get_url_extension(obj.ATTACHMENTPATH);
                        if (exttype.toUpperCase() == "PDF") {
                            row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + obj.PVCIMAGENAME + '"><a class="img-show" href="' + obj.ATTACHMENTPATH + '" value="' + obj.ATTACHMENTPATH + '" target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/pdf image.jpg" ></a>'

                        }
                        else if (exttype.toUpperCase() == "DOCX") {
                            row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + obj.PVCIMAGENAME + '"><a class="img-show" href="' + obj.ATTACHMENTPATH + '" value="' + obj.ATTACHMENTPATH + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/word.jpg" ></a>'

                        }
                        else if (exttype.toUpperCase() == "XLSX") {
                            row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + obj.PVCIMAGENAME + '"><a class="img-show" href="' + obj.ATTACHMENTPATH + '" value="' + obj.ATTACHMENTPATH + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/Excel image.jpg" ></a>'

                        }

                        else if (exttype.toUpperCase() == "JPG" || exttype.toUpperCase() == "JPEG" || exttype.toUpperCase() == "PNG") {
                            row = '<input type="checkbox" style="margin-left:5px" class="singlechkimage" id="' + obj.PVCIMAGENAME + '"><a class="img-show" href="' + obj.ATTACHMENTPATH + '" value="' + obj.ATTACHMENTPATH + '"  target="_blank"><img class="upload-image" src = "/AcxiomDesign/images/jpg-image.jpg" ></a>'

                        }

                        $('#divImgUpload').append(row);

                    });
                    $('#divImgUpload').append('<button class="btndeletecss"  style="margin-left:10px;float:right" type="button" onclick="Imagedelete( \'' + PVCNO + '\')" id="btnDelete">Delete</button>')
                }
                else {
                    ShowMessage(responsedata.responseText);
                }

            },
            complete: function () {
                $('#loading').hide();
                $('.loader_overlay').fadeOut();
            }
        });

    }

    function get_url_extension(url) {
        return url.split(/[#?]/)[0].split('.').pop().trim();
    }

    /*Account selection script*/

    function OpenSelectionAccount(usertype)
    {
        var CustApplicable = $('#PVHeader_CustomerApplicable').val();
        if (CustApplicable != 4) {
            if (usertype == 1)// Approver one
            {
                $('#ErrorMsg').text('');
                $('#SelectionAccountPopup').css({ display: "block" });
                $('#drpAccountSelectionPopup_chosen').css({ width: "150px" });
                $('#pvcAccountSelection tbody').empty();
                BindAccountSelectiontable();
            }
            else if (usertype == 2 || usertype == 3) //two Approver
            {
                $('#ErrorMsg').text('');
                $('#SelectionAccountPopup').css({ display: "block" });
                $('#drpAccountSelectionPopup_chosen').css({ width: "150px" });
                $('#pvcAccountSelection tbody').empty();

                $('#btnAccountAdd').css({ display: "none" });
                $('#btnAccountRemove').css({ display: "none" });

                BindAccountSelectiontable();
            }
            else if (usertype == 4)// Approver one
            {
                $('#ErrorMsg').text('');
                $('#SelectionAccountPopup').css({ display: "block" });
                $('#drpAccountSelectionPopup_chosen').css({ width: "150px" });
                $('#pvcAccountSelection tbody').empty();
                BindAccountSelectiontable();
            }
        }
    }

    function closeSelectionAccount() {

        $('#ErrorMsg').text('');
        $('#SelectionAccountPopup').css({ display: "none" });
        $('#pvcAccountSelection tbody').empty();
    }

    function OpenApplicantsPopup() {

        $('#ErrorMsg').text('');
        var CustApplicable = $('#PVHeader_CustomerApplicable').val();
        var AccountSelection = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();
        var entityid = '@Model.PVHeader.ENTITYID.ToString()'
        if (AccountSelection.length > 1)
        {
            $('#ErrorMsg').text('Please Select Only One CheckBox to Show Applicants');
            return false;
        }
        var RowCount = $("#pvcAccountSelection tbody").find("tr").length;
        if (RowCount == 1 && AccountSelection.length ==0)
        {
            AccountSelection = $("#pvcAccountSelection tbody tr:has(input:unchecked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(2)").text();
                return ItemCode;
            }).toArray();
        }
        $('#SelectionAccountPopup').css({ display: "none" });
        $('#tblpvcCustDetails tbody').empty();
        $('#btnCustomerAccountAdd').css({ display: "none" });
        $('#btnCustomerAccountRemove').css({ display: "none" });

        var table = $('#tblpvcCustDetails').DataTable();
        table.clear().draw();
        table.destroy();
        $('.loader_overlay, #loading').show();

        $.ajax({
            type: "POST",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/GetAccountlinkedcustomer?AccountSelectionID=' + AccountSelection + '&CustomerApplicable=' + CustApplicable + '&Entityid=' + entityid + '',
            success: function (responsedata) {

                $('#loading').hide();
                $('.loader_overlay').fadeOut();
                if (responsedata.success)
                {
                    var ischkheader = false;
                    $('#CustDetailsPopup').css({ display: "block" });
                    $('#tblpvcCustDetails tbody').empty();
                    var data = JSON.parse(responsedata.data);
                    var data2 = JSON.parse(responsedata.data2);
                    $.each(data2, function (index, obj) {

                        if (@headerstatus== 1 || @headerstatus==6)
                        {
                            if (obj.ISPORTALCREATED == "1" && obj.ISSYNCAX == "0")
                            {
                                ischkheader = true;
                                $('#btnCustomerAccountAdd').css({ display: "block" });
                                $('#btnCustomerAccountRemove').css({ display: "block" });

                            }
                            else
                            {
                                ischkheader = false;
                                $('#btnCustomerAccountAdd').css({ display: "none" });
                                $('#btnCustomerAccountRemove').css({ display: "none" });
                                $("#tblpvcCustDetails thead").find("tr:not(:first)").remove();

                            }
                        }

                    });

                    $.each(data, function (index, obj)
                    {

                        if (ischkheader)
                        {
                            var newrow = '<tr><td><input type ="checkbox" class="singleCustAccountSelection" id = "chkCustAccountSelectionfoot"></td><td>' + obj.AccountNum + '</td><td>' + obj.Name + ' </td></tr>'
                        }
                        else
                        {
                            var newrow = '<tr><td>' + obj.AccountNum + '</td><td>' + obj.Name + ' </td></tr>'
                        }
                        $('#tblpvcCustDetails tbody').append(newrow);

                    });

                    if (ischkheader)
                    {
                        if (@headerstatus== 1 || @headerstatus== 6)
                        {
                            BindCustomerindrp();
                        }
                        $('#tblpvcCustDetails thead').empty();
                        var newrow = '<tr><th><input type="checkbox" onclick="CustApplicantschkbox()" id="chkCustAccountSelection"></th><th>Customer Code</th><th> Customer Name</th></tr >';
                        //var newrow = '<tr><th><input type="checkbox" onclick="CustApplicantschkbox()" id="chkCustAccountSelection"></th><th>Customer Code</th>';
                        //newrow = newrow + '<th> Customer Name</th></tr > <tr><td></td><td><select id = "drpCustSelectionPopup" class = "searchable" style = "width:150px"></select></td><td></td></tr>';
                        $('#tblpvcCustDetails thead').append(newrow);
                    }
                    else
                    {
                        $('#tblpvcCustDetails thead').empty();
                        var newrow = '<tr><th>Customer Code</th>';
                        newrow = newrow + '<th> Customer Name</th></tr>';
                        $('#tblpvcCustDetails thead').append(newrow);
                    }

                }
                else {
                    ShowMessage(responsedata.responseText);
                }

            },
            complete: function () {
                $('#tblpvcCustDetails').DataTable({
                    scrollCollapse: true
                    , "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                    , "language": {
                        "search": ""
                        , "sLengthMenu": "Display _MENU_ Records"
                        , "info": "Displaying _START_ to _END_ of _TOTAL_ Records"
                        , "infoEmpty": "Displaying 0 to 0 of 0 Records"

                    }
                });
                $('#tblpvcCustDetails_filter').css({ display: "none" });
                $('#tblpvcCustDetails_length').css({ display: "none" });

                $('#loading').hide();
                $('.loader_overlay').fadeOut();
            }
        });





    }

    function closeApplicantsPopup() {

        $('#ErrorMsg').text('');
        $('#CustDetailsPopup').css({ display: "none" });
        $('#SelectionAccountPopup').css({ display: "block" });
    }

    function AddCustomerAccount() {
        $('#ErrorMsg').text('');

        $('#ErrorCustMsg').val('');
        var custAplicant = $('#drpCustSelectionPopup').val();
        if (custAplicant == "") {
            $('#ErrorCustMsg').text('Please Select the customer to add');
            return false;
        }
        else {

            var addon = false;
            $("#tblpvcCustDetails tbody ").find("tr").each(function () {

                var $td = jQuery(this).find("td");
                if ($td[1].innerHTML == custAplicant) {
                    $('#ErrorCustMsg').text('Selected Record is Already Present in table');
                    $('#drpCustSelectionPopup').get(0).selectedIndex = 0;
                    $("#drpCustSelectionPopup").chosen("destroy").chosen();
                    addon = true;

                }

            });
            if (!addon) {
                var pricegroupid = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
                    var $tr = $(this);
                    var ItemCode = $tr.find("td:nth-child(2)").text();
                    return ItemCode;
                }).toArray();
                var RowCount = $("#pvcAccountSelection tbody").find("tr").length;
                if (RowCount == 1 && pricegroupid.length == 0) {
                    pricegroupid = $("#pvcAccountSelection tbody tr:has(input:unchecked)").map(function () {
                        var $tr = $(this);
                        var ItemCode = $tr.find("td:nth-child(2)").text();
                        return ItemCode;
                    }).toArray();
                }
                var entityId = '@Model.PVHeader.ENTITYID.ToString()'
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    dataType: 'json',
                    url: '/PriceVariance/AddLinkedCustomer?custAplicantArray=' + custAplicant + '&Actiontype=1&PriceGroupId=' + pricegroupid + '&Entityid=' + entityId +'',
                    success: function (responsedata) {
                        if (responsedata.success) {
                            var data = JSON.parse(responsedata.data);
                            BindCustomerlinkedonPopup(data);
                        }

                        else {

                        }

                    }
                });
            }

        }
    }

    function RemoveCustomerAccount() {
        $('#ErrorMsg').text('');

        $('#ErrorCustMsg').val('');
        var custAplicant = $("#tblpvcCustDetails tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();
        if (custAplicant.length == 0) {
            $('#ErrorCustMsg').text('Please Select the Checkbox to remove the customer');
            return false;
        }
        else {
            var pricegroupid = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(2)").text();
                return ItemCode;
            }).toArray();
            var RowCount = $("#pvcAccountSelection tbody").find("tr").length;
            if (RowCount == 1 && pricegroupid.length == 0) {
                pricegroupid = $("#pvcAccountSelection tbody tr:has(input:unchecked)").map(function () {
                    var $tr = $(this);
                    var ItemCode = $tr.find("td:nth-child(2)").text();
                    return ItemCode;
                }).toArray();
            }
            var entityId = '@Model.PVHeader.ENTITYID.ToString()'
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/RemoveLinkedCustomer?custAplicantArray=' + custAplicant + '&Actiontype=2&PriceGroupId=' + pricegroupid + '&Entityid=' + entityId + '',
                success: function (responsedata) {
                    if (responsedata.success) {
                        var data = JSON.parse(responsedata.data);
                        BindCustomerlinkedonPopup(data);
                    }

                    else {

                    }

                }
            });
        }
    }

    function BindCustomerindrp() {

        $("#drpCustSelectionPopup").empty();
        $('#drpCustSelectionPopup').attr('enabled', 'true').chosen("destroy");
        var entityid = $('#PVHeader_Entity').val();
        $.ajax({
            type: "GET",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/GetAccountSelection?CustType=4&Entityid=' + entityid + '',
            success: function (responsedata) {

                $("#drpCustSelectionPopup").empty();
                $('#drpCustSelectionPopup').attr('enabled', 'true').chosen("destroy");
                var data = JSON.parse(responsedata);
                $('#drpCustSelectionPopup').append($("<option></option>").val('').html('Search'));//

                $.each(data, function (index, obj) {

                    $('#drpCustSelectionPopup').append($("<option></option>").val(obj.AccountNum).html(obj.CUSTOMERNAME));
                });


                $('#drpCustSelectionPopup').chosen();
            }
        });

    }

    function CustApplicantschkbox() {

        var $selectAccountAll = $('#chkCustAccountSelection'); // main checkbox customer account linking inside table thead

        $selectAccountAll.on('click', function () {

            $('.singleCustAccountSelection').prop('checked', this.checked);
        });
    }

    function BindCustomerlinkedonPopup(data) {
        if (data.length > 0) {
            if (data[0].Failure === undefined) {

                var table = $('#tblpvcCustDetails').DataTable();
                table.clear().draw();
                table.destroy();

                $('#tblpvcCustDetails tbody').empty();

                $.each(data, function (index, obj) {
                    if (obj.ISPORTALCREATED == "1" && obj.ISSYNCAX == "0") {
                        $('#btnCustomerAccountAdd').css({ display: "block" });
                        $('#btnCustomerAccountRemove').css({ display: "block" });
                    }
                    else {

                        $('#btnCustomerAccountAdd').css({ display: "none" });
                        $('#btnCustomerAccountRemove').css({ display: "none" });
                    }
                    var newrow = '<tr><td><input type ="checkbox" class="singleCustAccountSelection" id = "chkCustAccountSelectionfoot"></td><td>' + obj.AccountNum + '</td><td>' + obj.Name + ' </td></tr>'
                    $('#tblpvcCustDetails tbody').append(newrow);

                });

                $('#tblpvcCustDetails').DataTable({
                    scrollCollapse: true
                    , "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                    , "language": {
                        "search": ""
                        , "sLengthMenu": "Display _MENU_ Records"
                        , "info": "Displaying _START_ to _END_ of _TOTAL_ Records"
                        , "infoEmpty": "Displaying 0 to 0 of 0 Records"

                    }
                });
                $('#tblpvcCustDetails_filter').css({ display: "none" });
                $('#tblpvcCustDetails_length').css({ display: "none" });
            }
            else {
                $('#CustDetailsPopup').css({ display: "none" });
                ShowMessage(data[0].Failure);
            }
        }
        else {
            var table = $('#tblpvcCustDetails').DataTable();
            table.clear().draw();
            table.destroy();

            $('#tblpvcCustDetails tbody').empty();}
    }

    function RenameSelectionAccount()
    {
        $('#ErrorRenameGrpMsg').text('');
        var custAplicant = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();

        if (custAplicant.length == 0) {
            $('#ErrorMsg').text('Please Select the Checkbox to Rename the Account');
            return false;
        }
       else if (custAplicant.length >1) {
            $('#ErrorMsg').text('Please Select the only one price account  to Rename the Account');
            return false;
        }

        else {
        $('#SelectionAccountPopup').css({ display: "none" });
        $('#RenameGroupPopup').css({ display: "block" });


        var AccountSelectionid = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();

        var AccountSelectiontxt = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(3)").text();
            return ItemCode;
        }).toArray();
            $('#hdnAccSelectionid').val(AccountSelectionid);
            $('#hdnAccSelectionNameid').val(AccountSelectiontxt);
        $('#txtAccountSelection').val(AccountSelectionid);
        $('#txtAccountName').val(AccountSelectiontxt);


        }
    }

    function UpdateRenameGroup()
    {
        var accountid = $('#txtAccountSelection').val();
        var oldaccountid = $('#hdnAccSelectionid').val();
        var  Accountname=$('#txtAccountName').val();
        var oldAccountName = $('#hdnAccSelectionNameid').val();
        var pvcnumber = $('#Pvnumber').text();
        var entityId = '@Model.PVHeader.ENTITYID.ToString()'
        if (accountid != "" && Accountname != "")
        {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/UpdatepriceGroup?PriceGroupName=' + Accountname + '&Actiontype=1&PriceGroupId=' + accountid + '&olDPriceGroupId=' + oldaccountid + '&PVCNO=' + pvcnumber + '&olDPriceGroupName=' + oldAccountName + '&Entityid=' + entityId +'',
                success: function (responsedata) {
                    if (responsedata.success) {

                        var jsondata = JSON.parse(responsedata.data);
                        if (jsondata.length > 0)
                        {
                            $('#ErrorRenameGrpMsg').text(jsondata[0].Column1);
                        }
                        else
                        {

                            window.location.reload();
                        }
                    }

                    else {

                    }

                }
            });

        }
    }

    function closeNewGroupPopup() {
        $('#ErrorMsg').text('');
        $('#RenameGroupPopup').css({ display: "none" });
        $('#SelectionAccountPopup').css({ display: "block" });
    }

    function AddSelectionAccount() {

        $('#ErrorMsg').text('');
        var drpaccountselection = $('#drpAccountSelectionPopup').val();
        if (drpaccountselection != null && drpaccountselection != "") {

            var addon = false;
            $("#pvcAccountSelection tbody ").find("tr").each(function () {

                var $td = jQuery(this).find("td");
                if ($td[1].innerHTML == drpaccountselection) {
                    $('#ErrorMsg').text('Selected Record is Already Present in table');
                    $('#drpAccountSelectionPopup').get(0).selectedIndex = 0;
                    $("#drpAccountSelectionPopup").chosen("destroy").chosen();
                    addon = true;

                }

            });
            if (!addon) {

                $("#PVHeader_AccountSelection option[value='" + drpaccountselection + "']").prop("selected", true);
                var drpaccountselectiondesc = $('#drpAccountSelectionPopup option:selected').text();

                var newrow = '<tr><td><input type ="checkbox" class="singleAccountSelection" id = "chkAccountSelectionfoot"></input></td><td>' + drpaccountselection + '</td><td>' + drpaccountselectiondesc + ' </td></tr>'
                $('#pvcAccountSelection tbody').append(newrow);
                $('#drpAccountSelectionPopup').get(0).selectedIndex = 0;
                $("#drpAccountSelectionPopup").chosen("destroy").chosen();
                $("#PVHeader_AccountSelection").trigger("chosen:updated");
            }

        }
        else {
            $('#ErrorMsg').text('Please Select the Account Selection');
            return false;
        }
    }

    function RemoveSelectionAccount() {

        $('#ErrorMsg').text('');
        var itemCode = $("#pvcAccountSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();


        if (itemCode.length > 0) {
            for (var i = 0; i < itemCode.length; i++) {
                $("#PVHeader_AccountSelection option[value='" + itemCode[i] + "']").removeAttr("selected");

            }
            BindAccountSelectiontable()
            $("#PVHeader_AccountSelection").trigger("chosen:updated");
        }
        else {
            $('#ErrorMsg').text('Please select the line to remove');
            return false;
        }


    }

    function BindAccountSelectiontable() {
        $('#pvcAccountSelection tbody').empty();
        var AccountSelection = $('#PVHeader_AccountSelection').val();
        var AccountSelectiondesc = $('#PVHeader_AccountSelection option:selected').toArray().map(item => item.text);

        if (AccountSelection != null && AccountSelectiondesc != null) {
            for (var i = 0; i < AccountSelection.length; i++)
            {
                var accountname = AccountSelectiondesc[i].split('-');
                var newrow = '<tr><td><input type ="checkbox" class="singleAccountSelection" id = "chkAccountSelectionfoot"></input></td><td>' + AccountSelection[i] + '</td><td>' + accountname[1] + ' </td></tr>'
                $('#pvcAccountSelection tbody').append(newrow);
            }


        }


    }

    function SyncSelectiontoAx(pvcno,actiontype)
    {
        var pvcnumber = $('#Pvnumber').text();
        if (pvcnumber == "") {
            ShowMessage('PV No is blank!Please refresh the window');
            return false;
        }
        else {
            if (actiontype == 1) {
                Accountselectionsycn = true;
            }
            else if (actiontype == 2) {
                Itemselectionsycn = true;
            }
            $('.loader_overlay, #loading').show();
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/SyncAccountSelection?PVCNUM=' + pvcno + '&Actiontype=' + actiontype + '',
                success: function (responsedata) {
                    $('#loading').hide();
                    $('.loader_overlay').fadeOut();
                    if (responsedata.success) {

                        ShowMessage(responsedata.responseText);
                        if (actiontype == 1)
                        {
                            $('#btnSyncAccountSelection').css({ display: "none" });
                        }
                      else if (actiontype == 2) {
                            $('#btnSyncItemSelection').css({ display: "none" });
                        }
                    }
                    else {
                        ShowMessage(responsedata.responseText);
                    }

                },
                complete: function () {
                    $('#loading').hide();
                    $('.loader_overlay').fadeOut();
                }
            });

        }
    }

    /*End Account selection script*/

    /*Item selection script*/


    function OpenSelectionItem(usertype) {

        if (usertype == 1)
        {
            $('#ErrorItemMsg').text('');
            $('#SelectionItemPopup').css({ display: "block" });
            $('#pvcItemSelection tbody').empty();
            var itemtype = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(3)").text();
                return ItemCode;
            }).toArray();
            var itemGroupid = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(4)").text();
                return ItemCode;
            }).toArray();

            var itemGroupname = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(5)").text();
                return ItemCode;
            }).toArray();

            bindItemGroup(itemtype, itemGroupid, itemGroupname);
        }
        else if (usertype == 2|| usertype ==3)
        {
            $("#btnitemAdd").css({ display: "none" });
            $("#btnitemRemove").css({ display: "none" });
            $('#ErrorItemMsg').text('');
            $('#SelectionItemPopup').css({ display: "block" });
            $('#pvcItemSelection tbody').empty();
            var itemtype = $("#PvcLinetbl tbody tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(3)").text();
                return ItemCode;
            }).toArray();
            var itemGroupid = $("#PvcLinetbl tbody tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(4)").text();
                return ItemCode;
            }).toArray();

            var itemGroupname = $("#PvcLinetbl tbody tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(5)").text();
                return ItemCode;
            }).toArray();

            bindItemGroup(itemtype, itemGroupid, itemGroupname);
        }
        else if (usertype == 4)
        {

            $('#ErrorItemMsg').text('');
            $('#SelectionItemPopup').css({ display: "block" });
            $('#pvcItemSelection tbody').empty();
            var itemtype = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(3)").text();
                return ItemCode;
            }).toArray();
            var itemGroupid = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(4)").text();
                return ItemCode;
            }).toArray();

            var itemGroupname = $("#PvcLinetbl tfoot tr").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(5)").text();
                return ItemCode;
            }).toArray();

            bindItemGroup(itemtype, itemGroupid, itemGroupname);
        }
    }

    function closeSelectionItem() {

        $('#ErrorMsg').text('');
        $('#SelectionItemPopup').css({ display: "none" });
        $('#pvcItemSelection tbody').empty();
    }

    function bindItemGroup(itemtype, itemGroupid, itemGroupname) {

        for (var i = 0; i < itemtype.length; i++) {
            if (itemtype[i] == "ITEM GROUP") {
                var newrow = '<tr><td><input type ="checkbox" class="singleitemSelection" id = "chkitemSelectionfoot"></input></td><td>' + itemGroupid[i] + '</td><td>' + itemGroupname[i] + ' </td></tr>'
                $('#pvcItemSelection tbody').append(newrow);
            }
        }
    }

    function RemoveItemAccount() {

        $('#ErrorItemMsg').text('');
        var itemGroupid = $("#pvcItemSelection tbody tr:has(input:unchecked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();
        var itemGroupname = $("#pvcItemSelection tbody tr:has(input:unchecked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(3)").text();
            return ItemCode;
        }).toArray();

        var chkitemGroupid = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();

        if (@headerstatus== 1)
        {
            if (chkitemGroupid.length > 0) {
                var pvcnumber = $('#Pvnumber').text();
                var entityId = '@Model.PVHeader.ENTITYID.ToString()'
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    dataType: 'json',
                    url: '/PriceVariance/RemoveGroupItem?ITEMGROUPID=' + chkitemGroupid + '&PVCNO=' + pvcnumber + '&Entityid=' + entityId +'',
                    success: function (responsedata) {
                        if (responsedata.success) {

                            var jsondata = JSON.parse(responsedata.data);

                            $('#PvcLinetbl tfoot').empty();

                            $.each(jsondata, function (index, obj) {

                                var isapprove = false;
                                var isreject = false;
                                var checkbox = "";
                                var statusbuttonApp = "";
                                var statusbuttonreject = "";
                                if (obj.ISAPPROVE == 0) {

                                    isapprove = true;
                                    statusbuttonApp = '<button class="btnlineStatusApp" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                    statusbuttonreject = '<button class="btnlineStatusRejGray" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';
                                }
                                else if (obj.ISAPPROVE == 1) {
                                    isreject = true;
                                    statusbuttonApp = '<button class="btnlineStatusAppGray" onclick="UpdateLineStatusApproval(2,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">APPROVE</button>';
                                    statusbuttonreject = '<button class="btnlineStatusRej" onclick="UpdateLineStatusApproval(3,\'' + obj.ItemSelection + '\')" type="button" id="btnstatusline">REJECT</button>';

                                }
                                else {
                                    isreject = false;
                                    isapprove = false;
                                    statusbuttonApp = "";
                                    statusbuttonreject = "";

                                }
                                checkbox = '<input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input>';
                                var newRow = '<tr><td><input type="checkbox" class="singlechkbox" id="chkitemtfoot"></input></td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                                newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer.toFixed(1) + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                                newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';
                                //newRow = newRow + '<td>' + statusbuttonApp + '</td><td>' + statusbuttonreject + '</td><td></td><td></td></tr>';

                                $('#PvcLinetbl tfoot').append(newRow);
                                if (isapprove && isreject == false)
                                {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                    $("#btnApprove").css({ display: "block" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                if (isreject && isapprove == false) {
                                    $("#btnRequestchnage").css({ display: "block" });
                                    $("#btnReject").css({ display: "block" });
                                    $("#btnApprove").css({ display: "none" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                    $("#btnReject").css({ display: "none" });
                                }

                                if (isreject)
                                {

                                    $("#btnRequestchnage").css({ display: "block" });
                                }
                                else {
                                    $("#btnRequestchnage").css({ display: "none" });
                                }
                            });


                        }

                        else {

                        }

                    }
                });
            }
        }
        if (itemGroupid.length > 0) {
            $('#pvcItemSelection tbody').empty();
            for (var i = 0; i < itemGroupid.length; i++) {
                var newrow = '<tr><td><input type ="checkbox" class="singleitemSelection" id = "chkitemSelectionfoot"></input></td><td>' + itemGroupid[i] + '</td><td>' + itemGroupname[i] + ' </td></tr>'
                $('#pvcItemSelection tbody').append(newrow);

            }
        }
        else {
            $('#pvcItemSelection tbody').empty();
        }


    }


    function OpenItemsDetailsPopup() {

        $('#ErroritemDetailsMsg').text('');
        var entityid = '@Model.PVHeader.ENTITYID.ToString()'
        var ItemSelection = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();
        if (ItemSelection.length > 1) {
            $('#ErrorItemMsg').text('Please Select Only One CheckBox to Show Items');
            return false;
        }
        var RowCount = $("#pvcItemSelection tbody").find("tr").length;
        if (RowCount == 1 && ItemSelection.length == 0)
        {
            ItemSelection = $("#pvcItemSelection tbody tr:has(input:unchecked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(2)").text();
                return ItemCode;
            }).toArray();
        }
        $('#SelectionItemPopup').css({ display: "none" });
        $('#tblpvcitemDetails tbody').empty();
        $('#btnitemDetailsAdd').css({ display: "none" });
        $('#btnitemDetailsRemove').css({ display: "none" });

        var table = $('#tblpvcitemDetails').DataTable();
        table.clear().draw();
        table.destroy();
        $('.loader_overlay, #loading').show();

        $.ajax({
            type: "POST",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/GetGrouplinkedItems?ITEMGROUPID=' + ItemSelection + '&Dataareaid=' + entityid + '',
            success: function (responsedata) {
                var ischkheader = false;
                $('#loading').hide();
                $('.loader_overlay').fadeOut();
                if (responsedata.success) {
                    $('#itemDetailsPopup').css({ display: "block" });
                    $('#tblpvcitemDetails tbody').empty();
                    var data = JSON.parse(responsedata.data);

                    var data2 = JSON.parse(responsedata.data2);

                    $.each(data2, function (index, obj)
                    {
                         if (@headerstatus== "1" || @headerstatus== 6)
                        {
                            if (obj.ISPORTALCREATED == "1" && obj.ISSYNCAX == "0")
                            {
                                ischkheader = true;
                                $('#btnitemDetailsAdd').css({ display: "block" });
                                $('#btnitemDetailsRemove').css({ display: "block" });

                            }
                            else
                            {
                                ischkheader = false;
                                $("#tblpvcitemDetails thead").find("tr:not(:first)").remove();
                                $('#btnitemDetailsAdd').css({ display: "none" });
                                $('#btnitemDetailsRemove').css({ display: "none" });

                            }
                        }

                    });
                    $.each(data, function (index, obj) {

                        if (ischkheader)
                        {
                            var newrow = '<tr><td><input type ="checkbox" class="singleitemdetailsSelection" id = "chkitemdetailsSelectionfoot"></td><td>' + obj.ItemId + '</td><td>' + obj.Name + ' </td></tr>'
                        }
                        else
                        {
                            var newrow = '<tr><td>' + obj.ItemId + '</td><td>' + obj.Name + ' </td></tr>'
                        }
                        $('#tblpvcitemDetails tbody').append(newrow);


                    });
                    if (ischkheader)
                    {
                   if (@headerstatus== "1" ||@headerstatus== 6)
                    {
                        BindItems_initemdetailspopup();
                    }
                        $('#tblpvcitemDetails thead').empty();
                        var newrow = '<tr><th><input type="checkbox" onclick="itemdetailschkbox()"  id="chkitemdetailsSelection"></th><th>Item Number</th><th>Product Name</th></tr >';
                        //var newrow = '<tr><th><input type="checkbox" onclick="itemdetailschkbox()"  id="chkitemdetailsSelection"></th><th>Item Number</th>';
                        //newrow = newrow + '<th>Product Name</th></tr > <tr><td></td><td><select id = "drpitemdetailsPopup" class = "searchable" style = "width:250px"></select></td><td></td></tr>';
                        $('#tblpvcitemDetails thead').append(newrow);
                    }
                    else
                    {
                        $('#tblpvcitemDetails thead').empty();
                        var newrow = '<tr><th>Item Number</th>';
                        newrow = newrow + '<th>Product Name</th></tr>';
                        $('#tblpvcitemDetails thead').append(newrow);
                    }


                }
                else {
                    ShowMessage(responsedata.responseText);
                }

            },
            complete: function () {
                $('#tblpvcitemDetails').DataTable({
                    scrollCollapse: true
                    , "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                    , "language": {
                        "search": ""
                        , "sLengthMenu": "Display _MENU_ Records"
                        , "info": "Displaying _START_ to _END_ of _TOTAL_ Records"
                        , "infoEmpty": "Displaying 0 to 0 of 0 Records"

                    }
                });
                $('#tblpvcitemDetails_filter').css({ display: "none" });
                $('#tblpvcitemDetails_length').css({ display: "none" });

                $('#loading').hide();
                $('.loader_overlay').fadeOut();
            }
        });





    }

    function closeItemsDetailsPopup() {

        $('#ErrorItemMsg').text('');

        $('#itemDetailsPopup').css({ display: "none" });
        $('#SelectionItemPopup').css({ display: "block" });
    }

    function itemdetailschkbox() {
        var $selectitemdetailsAll = $('#chkitemdetailsSelection'); // main checkbox inside Account Selection table thead

        $selectitemdetailsAll.on('click', function () {

            $('.singleitemdetailsSelection').prop('checked', this.checked);
        });
    }

    function BindItems_initemdetailspopup() {

        $("#drpitemdetailsPopup").empty();
        $('#drpitemdetailsPopup').attr('enabled', 'true').chosen("destroy");
        var entityid = $('#PVHeader_Entity').val();
        $.ajax({
            type: "GET",
            crossDomain: true,
            dataType: 'json',
            url: '/PriceVariance/GetItemSelection?itemtype=1&Entityid=' + entityid + '',
            success: function (responsedata) {

                $("#drpitemdetailsPopup").empty();
                $('#drpitemdetailsPopup').attr('enabled', 'true').chosen("destroy");
                var data = JSON.parse(responsedata);
                $('#drpitemdetailsPopup').append($("<option></option>").val('').html('Search'));//

                $.each(data, function (index, obj) {

                    $('#drpitemdetailsPopup').append($("<option></option>").val(obj.ITEMID).html(obj.ITEMNAME));
                });


                $('#drpitemdetailsPopup').chosen();
            }
        });

    }

    function AdditemGroupDetails() {
        $('#ErrorItemMsg').text('');
        $('#ErroritemDetailsMsg').val('');
        var itemapplicant = $('#drpitemdetailsPopup').val();
        if (itemapplicant == "")
        {
            $('#ErroritemDetailsMsg').text('Please Select the item to add');
            return false;
        }
        else {

            var addon = false;
            $("#tblpvcitemDetails tbody ").find("tr").each(function () {

                var $td = jQuery(this).find("td");
                if ($td.length > 1) {
                    if ($td[1].innerHTML == itemapplicant) {
                        $('#ErroritemDetailsMsg').text('Selected Record is Already Present in table');
                        $('#drpitemdetailsPopup').get(0).selectedIndex = 0;
                        $("#drpitemdetailsPopup").chosen("destroy").chosen();
                        addon = true;

                    }
                }
            });
            if (!addon) {
                var itemgroupid = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
                    var $tr = $(this);
                    var ItemCode = $tr.find("td:nth-child(2)").text();
                    return ItemCode;
                }).toArray();
                var RowCount = $("#pvcItemSelection tbody").find("tr").length;
                if (RowCount == 1 && itemgroupid.length == 0) {
                    itemgroupid = $("#pvcItemSelection tbody tr:has(input:unchecked)").map(function () {
                        var $tr = $(this);
                        var ItemCode = $tr.find("td:nth-child(2)").text();
                        return ItemCode;
                    }).toArray();
                }
                var entityId = '@Model.PVHeader.ENTITYID.ToString()'
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    dataType: 'json',
                    url: '/PriceVariance/AddLinkedGroupItem?ITEMGROUPID=' + itemgroupid + '&Actiontype=1&ITEMID=' + itemapplicant + '&Entityid=' + entityId +'',
                    success: function (responsedata) {
                        if (responsedata.success) {

                            var data = JSON.parse(responsedata.data);
                            BindItemlinkedonPopup(data);
                        }

                        else {

                        }

                    }
                });
            }

        }
    }

    function RemoveitemGroupDetails() {
        $('#ErrorItemMsg').text('');
        $('#ErroritemDetailsMsg').val('');
        var itemid = $("#tblpvcitemDetails tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();
        if (itemid.length == 0) {
            $('#ErroritemDetailsMsg').text('Please Select the Checkbox to remove the customer');
            return false;
        }
        else {
            var itemgroupid = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(2)").text();
                return ItemCode;
            }).toArray();
            var RowCount = $("#pvcItemSelection tbody").find("tr").length;
            if (RowCount == 1 && itemgroupid.length == 0) {
                itemgroupid = $("#pvcItemSelection tbody tr:has(input:unchecked)").map(function () {
                    var $tr = $(this);
                    var ItemCode = $tr.find("td:nth-child(2)").text();
                    return ItemCode;
                }).toArray();
            }
            var entityId = '@Model.PVHeader.ENTITYID.ToString()'

            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/RemoveLinkedGroupItem?ITEMGROUPID=' + itemgroupid + '&Actiontype=2&ITEMID=' + itemid + '&Entityid=' + entityId +'',
                success: function (responsedata) {
                    if (responsedata.success) {

                        var data = JSON.parse(responsedata.data);
                        BindItemlinkedonPopup(data);
                    }

                    else {

                    }

                }
            });
        }
    }

    function BindItemlinkedonPopup(data) {

        if (data.length > 0) {
            if (data[0].Failure === undefined) {

                var table = $('#tblpvcitemDetails').DataTable();
                table.clear().draw();
                table.destroy();

                $('#tblpvcitemDetails tbody').empty();

                $.each(data, function (index, obj)
                {
                    if (obj.ISPORTALCREATED == "1" && obj.ISSYNCAX == "0") {

                        $('#btnitemDetailsAdd').css({ display: "block" });
                        $('#btnitemDetailsRemove').css({ display: "block" });

                    }
                    else {

                        $('#btnitemDetailsAdd').css({ display: "none" });
                        $('#btnitemDetailsRemove').css({ display: "none" });

                    }
                    var newrow = '<tr><td><input type ="checkbox" class="singleitemdetailsSelection" id = "chkitemdetailsSelectionfoot"></td><td>' + obj.ItemId + '</td><td>' + obj.Name + ' </td></tr>'
                    $('#tblpvcitemDetails tbody').append(newrow);

                });

                $('#tblpvcitemDetails').DataTable({
                    scrollCollapse: true
                    , "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                    , "language": {
                        "search": ""
                        , "sLengthMenu": "Display _MENU_ Records"
                        , "info": "Displaying _START_ to _END_ of _TOTAL_ Records"
                        , "infoEmpty": "Displaying 0 to 0 of 0 Records"

                    }
                });
                $('#tblpvcitemDetails_filter').css({ display: "none" });
                $('#tblpvcitemDetails_length').css({ display: "none" });
            }
            else {
                $('#itemDetailsPopup').css({ display: "none" });
                ShowMessage(data[0].Failure);
            }
        }
        else {
            var table = $('#tblpvcitemDetails').DataTable();
            table.clear().draw();
            table.destroy();

            $('#tblpvcitemDetails tbody').empty();
        }
    }

    function RenameitemAccount() {
        $('#ErrorRenameItemGrpMsg').text('');
        var custAplicant = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
            var $tr = $(this);
            var ItemCode = $tr.find("td:nth-child(2)").text();
            return ItemCode;
        }).toArray();

        if (custAplicant.length == 0) {
            $('#ErrorItemMsg').text('Please Select the Checkbox to Rename the Account');
            return false;
        }
        else if (custAplicant.length > 1) {
            $('#ErrorItemMsg').text('Please Select the only one Item Group  to Rename the Item Group');
            return false;
        }

        else {
            $('#SelectionItemPopup').css({ display: "none" });
            $('#RenameItemGroupPopup').css({ display: "block" });


            var Itemid = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(2)").text();
                return ItemCode;
            }).toArray();

            var Itemtxt = $("#pvcItemSelection tbody tr:has(input:checked)").map(function () {
                var $tr = $(this);
                var ItemCode = $tr.find("td:nth-child(3)").text();
                return ItemCode;
            }).toArray();
            $('#hdnItemid').val(Itemid);
            $('#hdnItemNameid').val(Itemtxt);
            $('#txtItemSelection').val(Itemid);
            $('#txtItemName').val(Itemtxt);


        }
    }

    function UpdateItemRenameGroup()
    {

        var Itemid = $('#txtItemSelection').val();
        var oldItemid = $('#hdnItemid').val();
        var Itemname = $('#txtItemName').val();
        var oldItemName = $('#hdnItemNameid').val();
        var pvcnumber = $('#Pvnumber').text();
        var entityId = '@Model.PVHeader.ENTITYID.ToString()'
        if (Itemid != "" && Itemname != "") {
            $.ajax({
                type: "POST",
                crossDomain: true,
                dataType: 'json',
                url: '/PriceVariance/UpdateItemGroup?ItemGroupName=' + Itemname + '&Actiontype=2&ItemGroupId=' + Itemid + '&OlDItemGroupId=' + oldItemid + '&PVCNO=' + pvcnumber + '&OlDItemGroupName=' + oldItemName + '&Entityid=' + entityId +'',
                success: function (responsedata) {
                    if (responsedata.success) {

                        var jsondata = JSON.parse(responsedata.data);
                        if (jsondata.length > 0)
                        {

                            if (jsondata[0].Column1 != undefined)
                            {
                                $('#ErrorRenameItemGrpMsg').text(jsondata[0].Column1);
                            }
                            else
                            {
                                $('#PvcLinetbl tbody').empty();
                                $.each(jsondata, function (index, obj) {
                                    var newRow = '<tr><td></td><td>' + obj.No + '</td><td>' + obj.ItemTypeDesc + '</td><td>' + obj.ItemSelection + '</td><td>' + obj.ItemName + '</td><td><span class="for_AmountSign">$ </span>' + obj.CurrentPriceVEP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.NewPriceVEP.toFixed(2) + '</td>';
                                    newRow = newRow + '<td><span class="for_AmountSign">$ </span>' + obj.NewPriceVIP.toFixed(2) + '</td><td><span class="for_AmountSign">$ </span>' + obj.Discount.toFixed(2) + '</td><td>' + obj.DiscountPer + '<span> % </span></td><td>' + obj.ExpectedVolumn + '</td>';
                                    newRow = newRow + '</tr>';
                                    $('#PvcLinetbl tbody').append(newRow);

                                });
                                $('#SelectionItemPopup').css({ display: "none" });
                                $('#RenameItemGroupPopup').css({ display: "none" });

                            }


                        }



                        }
                    }
                });

        }
    }

    function closeItemGroupPopup() {
        $('#ErrorRenameItemGrpMsg').text('');
        $('#ErrorItemMsg').text('');
        $('#SelectionItemPopup').css({ display: "block" });
        $('#RenameItemGroupPopup').css({ display: "none" });

    }

    /*EndItem selection script*/


</script>



